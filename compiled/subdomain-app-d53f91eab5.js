!function(){function t(e,n){if(!(e instanceof Object))return e;var i=e instanceof Array?[]:{};return _.each(e,(function(o,s){var a=e instanceof Array?s:n(s);i[a]=t(e[s],n)})),i}function e(t){return(t||"").replace(/_([a-z])/g,(function(t){return t[1].toUpperCase()}))}function n(t){return(t||"").replace(/([A-Z])/g,(function(t){return"_"+t[0].toLocaleLowerCase()})).replace(/^_/,"")}window.UTILS={camelize:function(n){return t(n,e)},decamelize:function(e){return t(e,n)}}}(),window.Vue&&window.Vuex&&(Vue.options.delimiters=["{:",":}"],Vue.config.productionTip=!1,Vue.config.devtools=!1,Vue.use(Vuex));var LOC=window.LOC={host:location.host,domain:location.host.split(".").slice(-2).join(".").split(":")[0],href:location.href,path:location.pathname,hash:location.hash.replace("#",""),protocol:location.protocol,base:location.toString().replace(/#.+$/,""),search:location.search};LOC.hash=LOC.hash?LOC.hash.split("-open")[0]:"";var isMobile=window.isMobile=/^\/m(\/.*)?$/.test(window.location.pathname);if(!window._ua)var _ua=navigator.userAgent.toLowerCase();var BROWSER={version:(_ua.match(/.+(?:me|ox|on|rv|it|era|ie)[\/: ]([\d.]+)/)||[0,"0"])[1],opera:/opera/i.test(_ua),msie:/msie/i.test(_ua)&&!/opera/i.test(_ua),msie6:/msie 6/i.test(_ua)&&!/opera/i.test(_ua),msie7:/msie 7/i.test(_ua)&&!/opera/i.test(_ua),msie8:/msie 8/i.test(_ua)&&!/opera/i.test(_ua),msie9:/msie 9/i.test(_ua)&&!/opera/i.test(_ua),mozilla:/firefox/i.test(_ua),chrome:/chrome/i.test(_ua),safari:!/chrome/i.test(_ua)&&/webkit|safari|khtml/i.test(_ua),iphone:/iphone/i.test(_ua),iphone4:/iphone.*OS 4/i.test(_ua),ipod:/ipod/i.test(_ua),ipod4:/ipod.*OS 4/i.test(_ua),ipad:/ipad/i.test(_ua),android:/android/i.test(_ua),bada:/bada/i.test(_ua),mobile:/iphone|ipod|ipad|opera mini|opera mobi|iemobile|android/i.test(_ua),msie_mobile:/iemobile/i.test(_ua),safari_mobile:/iphone|ipod|ipad/i.test(_ua),opera_mobile:/opera mini|opera mobi/i.test(_ua),opera_mini:/opera mini/i.test(_ua),mac:/mac/i.test(_ua)},CURRENT={},TIME={second:1e3,minute:6e4,hour:36e5,day:864e5,week:6048e5},KEY=window.KEY={BACKSPACE:8,TAB:9,ENTER:13,ESC:27,PAGEUP:33,PAGEDOWN:34,LEFT:37,UP:38,RIGHT:39,DOWN:40,SPACE:32,NUM0:48,NUM1:49,NUM2:50,NUM3:51,NUM4:52,NUM5:53,NUM6:54,NUM7:55,NUM8:56,NUM9:57,D:68,R:82,Y:89,NUM0_:96,NUM1_:97,NUM2_:98,NUM3_:99,NUM4_:100,NUM5_:101,NUM6_:102,NUM7_:103,NUM8_:104,NUM9_:105},SETTINGS=window.SETTINGS={};SETTINGS.ajaxParams={type:"post",dataType:"json",beforeSend:function(t,e){/^http:.*/.test(e.url)||/^https:.*/.test(e.url)||t.setRequestHeader("X-CSRFToken",FN.getCookie("csrftoken"))},error:function(t,e){var n="";switch(t.status){case 0:n="Нет соединения.";break;case 404:n="Запрашиваемая страница не найдена [404].";break;case 403:n=t.responseText||"Доступ запрещен [403].";break;case 500:n="Внутренняя ошибка сервера [500]. Это плохо.<br/>Но разработчикам уже отправлены данные об ошибке,<br/>и скоро всё наладится.";break;default:switch(e){case"parsererror":n="Запрашиваемый JSON-парсинг не удался.";break;case"timeout":n="Ошибка времени ожидания.";break;case"abort":n="Ajax-запрос прерван.";break;default:n=t.responseText||"Другая ошибка"}}var i='Ошибка ajax-запроса:  <div class="response"><b>'+n+"</b></div>";FN.showTopMessage(i,7)}},$.ajaxSetup(SETTINGS.ajaxParams),SETTINGS.validationMessages={required:"Поле должно быть заполнено.",email:"Неверный формат e-mail.",url:"Неверный формат URL.",date:"Неверный формат даты.",dateISO:"Неверный формат даты (ISO).",number:"Введите число.",digits:"Допускаются только цифры.",ruDate:'Введите корректную дату (в формате "dd.mm.yyyy")'},$.validator&&($.extend($.validator.messages,SETTINGS.validationMessages),$.validator.addMethod("ruDate",(function(t,e){return FN.validate.ruDate(t)}),SETTINGS.validationMessages.ruDate));var TABLE={getRows:function(t){if(t){var e=FN.geByTag1("tbody",t)||t;return FN.geByTag("tr",e)}},getCells:function(t){if(t){var e=FN.geByTag1("tbody",t)||t;return FN.geByTag("td",e)}},getVisibleRows:function(t){if(t){var e=[],n=FN.geByTag1("tbody",t)||t,i=FN.geByTag("tr",n);return FN.each(i,(function(t,n){FN.isVisible(n)&&e.push(i[t])})),e}},getOddRows:function(t){return this._getRowsByParams(t,!0,!1)},getVisibleOddRows:function(t){return this._getRowsByParams(t,!0,!0)},getEvenRows:function(t){return this._getRowsByParams(t,!1,!1)},getVisibleEvenRows:function(t){return this._getRowsByParams(t,!1,!0)},doEvenRows:function(t){var e=this.getRows(t);FN.each(e,(function(t,e){FN.removeClass(e,"even")})),e=this.getVisibleEvenRows(t),FN.each(e,(function(t,e){FN.addClass(e,"even")}))},doOddRows:function(t){var e=this.getRows(t);FN.each(e,(function(t,e){FN.removeClass(e,"odd")})),e=this.getVisibleOddRows(t),FN.each(e,(function(t,e){FN.addClass(e,"odd")}))},_getRowsByParams:function(t,e,n){var i=[],o=e?0:1,s=n?TABLE.getVisibleRows(t):TABLE.getRows(t);return FN.each(s,(function(t,e){t%2===o&&i.push(e)})),i}},TABLE_SORTER={textExtraction:function(t){var e=t.getAttribute("data-sorter");return null!==e?1*(e||"").replace(",","."):(FN.geByClass1("sorting_text",t)||t).innerText}},CHARTS={processData:function(t){t&&FN.each(t,(function(t,e){FN.each(e,(function(t,n){null===n&&(e[t]=void 0)}))}))},toggleLabels:function(t,e,n){t&&e&&n&&(!e.hidden&&n.hidden?(e.labelText="[[value]]",t.validateNow()):(e.labelText="",t.validateNow()))},toggleBullets:function(t,e,n){t&&e&&n&&(!e.hidden&&n.hidden?(e.bullet="round",e.showBalloon=!0,t.validateNow()):(e.bullet="none",e.showBalloon=!1,t.validateNow()))},labelFunction:function(t,e){return function(n,i,o){return t<=n&&n<=e?n:""}}};Function.prototype.pbind=function(){var t=Array.prototype.slice.call(arguments);return t.unshift(window),this.bind.apply(this,t)},Function.prototype.bind=function(){var t=this,e=Array.prototype.slice.call(arguments),n=e.shift();return function(){var i=Array.prototype.slice.call(arguments);return t.apply(n,e.concat(i))}};var FN={getCookie:function(t){var e=null;if(document.cookie&&""!=document.cookie){var n,i,o=document.cookie.split(";"),s=o.length;for(n=0;n<s;n+=1)if((i=FN.trim(o[n])).substring(0,t.length+1)==t+"="){e=decodeURIComponent(i.substring(t.length+1));break}}return e},validate:{}};FN.validate.ruDate=function(t){if(!t.match(/^\d\d?\.\d\d?\.\d\d\d\d$/))return!1;var e=t.split(".");if(3!==e.length)return!1;var n=e[1]+"/"+e[0]+"/"+e[2],i=new Date(Date.parse(n)),o={date:i.getDate(),month:i.getMonth()+1,year:i.getFullYear()};return o.date=o.date<10?"0"+o.date:o.date,o.month=o.month<10?"0"+o.month:o.month,t===o.date+"."+o.month+"."+o.year},FN.showTopMessage=function(t,e,n){var i=FN.showTopMessage,o=FN.ge("system_msg");t?(clearTimeout(i.timer),o.style.backgroundColor=n||"pink",o.innerHTML=t,FN.show(o),e&&(i.timer=setTimeout((function(){o.innerHTML="",FN.hide(o),i.pbind(!1)}),1e3*e))):FN.hide(o)},FN.log=function(t,e){console.log(t)},FN.toFixed=function(t,e){return void 0===e&&(e=5),t.toFixed(e).replace(/\.(\d*?)(0+)$/g,(function(t,e,n){return t.substring(0,t.length-(e.length?0:1)-n.length)}))},FN.rand=function(t,e){return Math.random()*(e-t)+t},FN.irand=function(t,e){return Math.floor(Math.random()*(e-t+1)+t)},FN.isFunction=function(t){return"[object Function]"===Object.prototype.toString.call(t)},FN.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},FN.isObject=function(t){return"[object Object]"===Object.prototype.toString.call(t)},FN.isEmpty=function(t){if("[object Object]"!==Object.prototype.toString.call(t))return!1;for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},FN.trim=function(t){return(t||"").replace(/^\s+|\s+$/g,"")},FN.stripHTML=function(t){return t?t.replace(/<(?:.|\s)*?>/g,""):""},FN.intval=function(t){return!0===t?1:parseInt(t)||0},FN.floatval=function(t){return!0===t?1:parseFloat(t)||0},FN.positive=function(t){return(t=FN.intval(t))<0?0:t},FN.parseJSON=function(str){var obj;return eval("obj = "+str),obj||{}},FN.insertAtCaret=function(t,e){if(document.selection)t.focus(),document.selection.createRange().text=e,t.focus();else if(t.selectionStart||"0"==t.selectionStart){var n=t.selectionStart,i=t.selectionEnd,o=t.scrollTop;t.value=t.value.substring(0,n)+e+t.value.substring(i,t.value.length),t.focus(),t.selectionStart=n+e.length,t.selectionEnd=n+e.length,t.scrollTop=o}else t.value+=e,t.focus()},FN.each=function(t,e){var n,i=t.length;if(void 0===i){for(var o in t)if(t.hasOwnProperty(o)&&(n=t[o],!1===e.call(n,o,n)))break}else for(var s=0;s<i&&(n=t[s],!1!==e.call(n,s,n));s+=1);},FN.indexOf=function(t,e,n){for(var i=n||0,o=(t||[]).length;i<o;i+=1)if(e===t[i])return i;return-1},FN.inArray=function(t,e){return-1!==FN.indexOf(e,t)},FN.clone=function(t,e){var n=FN.isArray(t)?[]:{};for(var i in t){var o=t[i];n[i]=e&&"object"==typeof o&&"prototype"!==i?FN.clone(o):o}return n},FN.arrayKeyDiff=function(t){var e,n={},i=arguments,o=arguments.length;for(var s in t){e=!1;for(var a=1;a<o;a++)i[a][s]&&i[a][s]==t[s]&&(e=!0);e||(n[s]=t[s])}return n},FN.extend=function(){var t,e=arguments,n=e[0]||{},i=!1,o=1,s=e.length;for("boolean"==typeof n&&(i=n,n=e[1]||{},o=2);o<s;o++)if(null!=(t=e[o]))for(var a in t){var r=n[a],l=t[a];r!==l&&(i&&l&&"object"==typeof l&&!l.nodeType?n[a]=FN.extend(i,r||{},l):void 0!==l&&(n[a]=l))}return n},FN.hasClass=function(t,e){t=FN.ge(t);var n=new RegExp("(\\s|^)"+e+"(\\s|$)");return t&&n.test(t.className)},FN.addClass=function(t,e){(t=FN.ge(t))&&!FN.hasClass(t,e)&&(t.className=(t.className?t.className+" ":"")+e)},FN.removeClass=function(t,e){if(t=FN.ge(t)){var n=new RegExp("(\\s|^)"+e+"(\\s|$)");t.className=FN.trim((t.className||"").replace(n," "))}},FN.toggleClass=function(t,e,n){void 0===n&&(n=!FN.hasClass(t,e)),(n?FN.addClass:FN.removeClass)(t,e)},FN.replaceClass=function(t,e,n){FN.removeClass(t,e),FN.addClass(t,n)},FN.getStyle=function(t,e,n){if(t=FN.ge(t),FN.isArray(e)){var i={};return FN.each(e,(function(e,n){i[n]=FN.getStyle(t,n)})),i}if(void 0===n&&(n=!0),!n&&"opacity"===e&&BROWSER.msie)return(r=t.style.filter)?r.indexOf("opacity=")>=0?parseFloat(r.match(/opacity=([^)]*)/)[1])/100+"":"1":"";if(!n&&t.style&&(t.style[e]||"height"===e))return t.style[e];var o,s=document.defaultView||window;if(s.getComputedStyle){e=e.replace(/([A-Z])/g,"-$1").toLowerCase();var a=s.getComputedStyle(t,null);a&&(o=a.getPropertyValue(e))}else if(t.currentStyle){var r;if("opacity"==e&&BROWSER.msie)return(r=t.currentStyle.filter)&&r.indexOf("opacity=")>=0?parseFloat(r.match(/opacity=([^)]*)/)[1])/100+"":"1";var l=e.replace(/\-(\w)/g,(function(t,e){return e.toUpperCase()}));if("auto"==(o=t.currentStyle[e]||t.currentStyle[l])&&(o=0),!/^\d+(px)?$/i.test(o)&&/^\d/.test(o)){var c=t.style,u=c.left,d=t.runtimeStyle.left;t.runtimeStyle.left=t.currentStyle.left,c.left=o||0,o=c.pixelLeft+"px",c.left=u,t.runtimeStyle.left=d}}if(n&&("width"===e||"height"===e)){var h=FN.getSize(t,!0)[{width:0,height:1}[e]];o=(FN.intval(o)?Math.max(FN.floatval(o),h):h)+"px"}return o},FN.setStyle=function(t,e,n){if(t=FN.ge(t))if("object"!=typeof e)if("opacity"==e)BROWSER.msie&&((n+"").length?t.style.filter=1!==n?"alpha(opacity="+100*n+")":"":t.style.cssText=t.style.cssText.replace(/filter\s*:[^;]*/gi,""),t.style.zoom=1),t.style.opacity=n;else try{var i="number"==typeof n;i&&/width|height/i.test(e)&&(n=Math.abs(n)),t.style[e]=i&&!/z-?index|font-?weight|opacity|zoom|line-?height/i.test(e)?n+"px":n}catch(t){}else FN.each(e,(function(e,n){FN.setStyle(t,e,n)}))},FN.getXY=function(t,e){if(!(t=FN.ge(t)))return[0,0];var n,i,o=0,s=0;if(t.offsetParent)do{o+=n=t.offsetLeft,s+=t.offsetTop,"absolute"!==(i=FN.getStyle(t,"position"))&&"relative"!==i&&"fixed"!==i||(o-=t.scrollLeft,s-=t.scrollTop),"fixed"!==i||e||(o+=(t.offsetParent||{}).scrollLeft||bodyNode.scrollLeft||htmlNode.scrollLeft,s+=(t.offsetParent||{}).scrollTop||bodyNode.scrollTop||htmlNode.scrollTop)}while(t=t.offsetParent);return e&&BROWSER.msie&&BROWSER.version<9&&n&&(o+=FN.ge("page_layout").offsetLeft),[o,s]},FN.getZoom=function(){var t=FN.ge("test_zoom_r1")||document.body.appendChild(FN.ce("div",{id:"test_zoom_r1"},{left:"10%",position:"absolute",visibility:"hidden"}));return(FN.ge("test_zoom_r2")||document.body.appendChild(FN.ce("div",{id:"test_zoom_r2"},{left:t.offsetLeft+"px",position:"absolute",visibility:"hidden"}))).offsetLeft/t.offsetLeft},FN.ge=function(t){return"string"==typeof t||"number"==typeof t?document.getElementById(t):t},FN.geByTag=function(t,e){return(e||document).getElementsByTagName(t)},FN.geByTag1=function(t,e){return(e=e||document).querySelector&&e.querySelector(t)||FN.geByTag(t,e)[0]},FN.geByAttr=function(t,e,n,i){var o=[],s=FN.geByTag(n||"*",i);return t?(FN.each(s,(function(n,i){null!==e?i.getAttribute(t)===e&&o.push(i):null!==i.getAttribute(t)&&o.push(i)})),o):s},FN.geByAttr1=function(t,e,n,i){return i=i||document,n=n||"*",FN.geByAttr(t,e,n,i)[0]},FN.hasAttr=function(t,e,n){if(!t||!t.getAttribute)return!1;if(void 0===n){if(null!==t.getAttribute(e))return!0}else if(t.getAttribute(e)===n)return!0;return!1},FN.geByClass=function(t,e,n){e=e||document,n=n||"*";var i=[];if(!BROWSER.msie8&&e.querySelectorAll&&"*"!==n){var o=e.querySelectorAll(n+"."+t);return o=Array.prototype.slice.call(o,0)}if(e.getElementsByClassName){o=e.getElementsByClassName(t);if("*"!==n){n=n.toUpperCase();for(var s=0,a=o.length;s<a;s++)o[s].tagName.toUpperCase()===n&&i.push(o[s])}else i=Array.prototype.slice.call(o,0);return i}var r=FN.geByTag(n,e),l=new RegExp("(^|\\s)"+t+"(\\s|$)");for(s=0,a=r.length;s<a;s++)l.test(r[s].className)&&i.push(r[s]);return i},FN.geByClass1=function(t,e,n){return e=e||document,n=n||"*",!BROWSER.msie8&&e.querySelector&&e.querySelector(n+"."+t)||FN.geByClass(t,e,n)[0]},FN.ce=function(t,e,n){var i=document.createElement(t);return e&&FN.extend(i,e),n&&FN.setStyle(i,n),i},FN.re=function(t){return(t=FN.ge(t))&&t.parentNode&&t.parentNode.removeChild(t),t},FN.domEL=function(t,e){for(e=e?"previousSibling":"nextSibling";t&&!t.tagName;)t=t[e];return t},FN.domNS=function(t){return FN.domEL((t||{}).nextSibling)},FN.domVNS=function(t){t=t||{};do{t=FN.domEL(t.nextSibling)}while(t&&!FN.isVisible(t));return t},FN.domPS=function(t){return FN.domEL((t||{}).previousSibling,!0)},FN.domVPS=function(t){t=t||{};do{t=FN.domEL(t.previousSibling,!0)}while(t&&!FN.isVisible(t));return t},FN.domFC=function(t){return FN.domEL((t||{}).firstChild)},FN.domLC=function(t){return FN.domEL((t||{}).lastChild,!0)},FN.domPN=function(t){return(t||{}).parentNode},FN.domPNs=function(t){if(t.parentNode)do{t=t.parentNode}while(t);return t},FN.getIndex=function(t,e){if(t&&(e||t.tagName)){for(var n=t.tagName,i=0,o=(e=e||t.parentNode.getElementsByTagName(n)).length;i<o;i+=1)if(t===e[i])return i;return-1}},FN.isAncestor=function(t,e){var n=FN.ge(t);if(e=FN.ge(e),!t||!e)return!1;for(;n=n.parentNode;)if(n===e)return!0;return!1},FN.isChildNode=function(t,e){for(var n in t.childNodes)if(1===t.childNodes[n].nodeType){if(t.childNodes[n]===e)return!0;if(FN.isChildNode(t.childNodes[n],e))return!0}return!1},FN.getVisibleNodes=function(t){var e=[];return FN.each(t,(function(t,n){FN.isVisible(n)&&e.push(n[t])})),e},FN.show=function(t){var e=arguments.length;if(e>1)for(var n=0;n<e;n++)FN.show(arguments[n]);else if((t=FN.ge(t))&&t.style){var i=t.olddisplay||FN.getStyle(t,"display")||"",o="block",s=t.tagName.toLowerCase();t.style.display=i,"none"==i&&(FN.hasClass(t,"inline")?o="inline":"tr"!=s||BROWSER.msie?"table"!=s||BROWSER.msie||(o="table"):o="table-row",t.style.display=t.olddisplay=o)}},FN.hide=function(t){var e=arguments.length;if(e>1)for(var n=0;n<e;n++)FN.hide(arguments[n]);else if((t=FN.ge(t))&&t.style){var i=FN.getStyle(t,"display");t.olddisplay="none"!==i?i:"",t.style.display="none"}},FN.toggle=function(t,e){void 0===e&&(e=!FN.isVisible(t)),e?FN.show(t):FN.hide(t)},FN.isVisible=function(t){return!(!(t=FN.ge(t))||!t.style)&&"none"!=FN.getStyle(t,"display")},FN.getSize=function(t,e){t=FN.ge(t);var n=[0,0],i=document.documentElement;if(t===document)return[Math.max(i.clientWidth,bodyNode.scrollWidth,i.scrollWidth,bodyNode.offsetWidth,i.offsetWidth),Math.max(i.clientHeight,bodyNode.scrollHeight,i.scrollHeight,bodyNode.offsetHeight,i.offsetHeight)];if(t){function o(){n=[t.offsetWidth,t.offsetHeight],e&&(FN.each(n,(function(e,i){var o=e?["Top","Bottom"]:["Left","Right"];FN.each(o,(function(){n[e]-=parseFloat(FN.getStyle(t,"padding"+this))||0,n[e]-=parseFloat(FN.getStyle(t,"border"+this+"Width"))||0}))})),n=[Math.round(n[0]),Math.round(n[1])])}if(FN.isVisible(t))o();else{var s={position:"absolute",visibility:"hidden",display:"block"},a={};FN.each(s,(function(e,n){a[e]=t.style[e],t.style[e]=n})),o(),FN.each(s,(function(e,n){t.style[e]=a[e]}))}}return n},FN.sbWidth=function(){if(void 0===window._sbWidth){var t=FN.ce("div",{innerHTML:'<div style="height: 75px;">t</div>'},{overflowY:"scroll",position:"absolute",width:"50px",height:"50px"});bodyNode.appendChild(t),window._sbWidth=Math.max(0,t.offsetWidth-FN.domFC(t).offsetWidth-1),bodyNode.removeChild(t)}return window._sbWidth},FN.removeAttr=function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];if(void 0!==t[n])try{delete t[n]}catch(e){try{t.removeAttribute(n)}catch(t){}}}},FN.cleanElems=function(){for(var t=arguments,e=0;e<t.length;e++){var n=FN.ge(t[e]);n&&FN.removeAttr(n,"btnevents")}},FN.preventDefaultBrowserScroll=function(){"scrollRestoration"in history&&(history.scrollRestoration="manual")},FN.scrollToElem=function(t){(t=FN.ge(t))&&(document.documentElement.scrollTop=document.body.scrollTop=FN.getXY(t)[1])},FN.animate=function(t,e,n,i){},FN.fadeTo=function(t,e,n,i){};var Fx={Transitions:{linear:function(t,e,n,i){return n*t/i+e},sineInOut:function(t,e,n,i){return-n/2*(Math.cos(Math.PI*t/i)-1)+e},halfSine:function(t,e,n,i){return n*Math.sin(Math.PI*(t/i)/2)+e},easeOutBack:function(t,e,n,i){var o=1.70158;return n*((t=t/i-1)*t*((o+1)*t+o)+1)+e},easeInCirc:function(t,e,n,i){return-n*(Math.sqrt(1-(t/=i)*t)-1)+e},easeOutCirc:function(t,e,n,i){return n*Math.sqrt(1-(t=t/i-1)*t)+e},easeInQuint:function(t,e,n,i){return n*(t/=i)*t*t*t*t+e},easeOutQuint:function(t,e,n,i){return n*((t=t/i-1)*t*t*t*t+1)+e},easeOutCubic:function(t,e,n,i){return n*((t=t/i-1)*t*t+1)+e}},Attrs:[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity","left","top"]],Timers:[],TimerId:null},fx=Fx;function genFx(t,e){var n={};return FN.each(Fx.Attrs.concat.apply([],Fx.Attrs.slice(0,e)),(function(){n[this]=t})),n}function getRGB(t){var e;return t&&FN.isArray(t)&&3==t.length?t:(e=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)\s*/.exec(t))?[parseInt(e[1]),parseInt(e[2]),parseInt(e[3])]:(e=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(t))?[2.55*parseFloat(e[1]),2.55*parseFloat(e[2]),2.55*parseFloat(e[3])]:(e=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(t))?[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]:(e=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(t))?[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]:void 0}function getColor(t,e){var n;do{if((n=FN.getStyle(t,e)).indexOf("rgba")||(n=""),""!=n&&"transparent"!=n||"body"==t.nodeName.toLowerCase())break;e="backgroundColor"}while(t=t.parentNode);return getRGB(n)}function scrollToY(t,e,n,i){}function scrollToTop(t){return scrollToY(0,t)}function scrollGetY(){return window.pageYOffset||scrollNode.scrollTop||document.documentElement.scrollTop}function addEvent(t,e,n){var i;(t=FN.ge(t))&&3!==t.nodeType&&8!==t.nodeType&&(n.$$guid||(n.$$guid=addEvent.guid++),t.events||(t.events={}),FN.each(e.split(/\s+/),(function(e,o){var s=o.split(".")[1]||n.$$guid;o=o.split(".")[0],(i=t.events[o])||(i=t.events[o]={},t["on"+o]&&(i[0]=t["on"+o])),i[s]=n,t["on"+o]=handleEvent.bind(t)})))}function removeEvent(t,e){if(t=FN.ge(t)){var n=e.split(".")[1];e=e.split(".")[0],t.events&&t.events[e]&&(n?delete t.events[e][n]:(delete t.events[e],t["on"+e]=function(){}))}}function handleEvent(t){var e=!0;t=t||fixEvent(window.event);var n=this.events[t.type];for(var i in n)this.$$handleEvent=n[i],!1===this.$$handleEvent(t)&&(e=!1);return e}function fixEvent(t){return t.preventDefault=function(){return this.returnValue=!1},t.stopPropagation=function(){return this.cancelBubble=!1},t}function cancelEvent(t){if(!(t=t||window.event))return!1;for(;t.originalEvent;)t=t.originalEvent;return t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0,t.returnValue=!1,!1}function checkEvent(t){return(t=t||window.event)&&("click"===t.type||"mousedown"===t.type||"mouseup"===t.type)&&(t.which>1||t.button>1||t.ctrlKey||t.shiftKey||BROWSER.mac&&t.metaKey)}function addDocumentOutsideClick(t,e,n){addEvent(document,"click",(function(i){isInsideByAttr((i=i||window.event).target||i.srcElement,t,e)||n()}))}function isInsideByAttr(t,e,n){return!!FN.hasAttr(t,e,n)||!!t.parentNode&&isInsideByAttr(t.parentNode,e,n)}function doMouseEvent(t,e){if(t=FN.ge(t)){var n=document.createEvent("MouseEvents");n.initMouseEvent(e,!0,!0,window,0,0,0,0,0,!1,!1,!0,!1,0,null),t.dispatchEvent(n)}}Fx.Base=function(t,e,n){this.el=FN.ge(t),this.name=n,this.options=FN.extend({onComplete:function(){},transition:e.transition||Fx.Transitions.sineInOut,duration:500},e||{})},FN.each({slideDown:genFx("show",1),slideUp:genFx("hide",1),slideToggle:genFx("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},(function(t,e){window[t]=function(t,n,i){return animate(t,e,n,i)}})),Fx.Base.prototype={start:function(){},stop:function(){},step:function(){},compute:function(){},update:function(){},cur:function(){}},addEvent.guid=1;var _layerAnim=!1,layers={visible:!1,sh:(!_layerAnim||BROWSER.msie||BROWSER.iphone,function(t,e){FN.show(t),e&&e()}),hd:(!_layerAnim||BROWSER.msie||BROWSER.iphone,function(t,e){FN.hide(t),e&&e()}),_show:function(t,e,n,i){FN.setStyle(t,{opacity:n||"",backgroundColor:i||""}),layers.visible||(BROWSER.mozilla?(window._oldScroll=htmlNode.scrollTop,pageNode.style.height=_oldScroll+lastWindowHeight+"px",pageNode.style.marginTop=-_oldScroll+"px"):(BROWSER.msie7?htmlNode:bodyNode).style.overflow="hidden",layers.visible=!0),e.visibilityHide?FN.removeClass(e,"box_layer_hidden"):FN.show(e),layers.sh(t)},_hide:function(t,e){layers.hd(t,(function(){e&&e.visibilityHide?FN.addClass(e,"box_layer_hidden"):FN.hide(e),FN.isVisible(layerWrap)||CURRENT._inLayer||FN.isVisible(boxLayerWrap)&&!boxLayerWrap.visibilityHide||(layers.visible=!1,BROWSER.mozilla?(pageNode.style.height="auto",pageNode.style.marginTop="0px",window._oldScroll&&(htmlNode.scrollTop=_oldScroll)):(BROWSER.msie7?htmlNode:bodyNode).style.overflow="auto")}))}},_message_box_guid=0,_message_boxes=[],_message_box_shown=!1;function boxRefreshCoords(t){var e=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:boxLayerBG.offsetHeight,n=BROWSER.mobile?FN.intval(window.pageYOffset):0,i=FN.getSize(t)[1];t.style.marginTop=Math.max(10,n+(e-i)/3)+"px"}var __bq=boxQueue={_boxes:[],curBox:0,hideAll:function(){__bq.count()&&((t=_message_boxes[__bq._boxes.pop()])._in_queue=!1,t.hide());for(;__bq.count();){var t;(t=_message_boxes[__bq._boxes.pop()])._in_queue=!1}},hideLast:function(t,e){if(__bq.count()){var n=_message_boxes[__bq._boxes[__bq.count()-1]];if(!0===t&&(n.changed||__bq.skip))return void(__bq.skip=!1);n.hide()}if(e&&"click"===e.type)return cancelEvent(e)},hideBGClick:function(t){t&&t.target&&/^box_layer/.test(t.target.id)&&__bq.hideLast()},count:function(){return __bq._boxes.length},_show:function(t){var e=_message_boxes[t];if(e&&!e._in_queue){__bq.count()?_message_boxes[__bq._boxes[__bq.count()-1]]._hide(!0,!0):window.tooltips,e._in_queue=!0;var n=!!__bq.count();__bq.curBox=t,e._show(n||__bq.currHiding,n),__bq._boxes.push(t)}},_hide:function(t){var e=_message_boxes[t];if(e&&e._in_queue&&__bq._boxes[__bq.count()-1]==t&&e.isVisible()&&(e._in_queue=!1,__bq._boxes.pop(),e._hide(!!__bq.count()),__bq.count())){var n=__bq._boxes[__bq.count()-1];__bq.curBox=n,_message_boxes[n]._show(!0,!0,!0)}}};function curBox(){var t=_message_boxes[__bq.curBox];return t&&t.isVisible()?t:null}function MessageBox(t,e){t=FN.extend({title:!1,width:410,height:"auto",animSpeed:0,bodyStyle:"",dark:!1,selfDestruct:!0,progress:!1,noCloseButton:!1,hideOnBGClick:!0,hideButtons:!1,onShow:!1,onHideAttempt:!1,onBeforeHide:!1,onHide:!1,onClean:!1,onDestroy:!1,borderRadius:0,boxTitleWrap:'<div class="box_title_wrap"><div class="box_x_button"></div><div class="box_title"></div></div>'},t),e&&(t.dark=e);var n,i,o,s,a,r,l,c,u,d,h,p=_message_box_guid++,f=!1;t.progress||(t.progress="box_progress"+p);var g=t.hideButtons?' style="display: none"':"";function _(){t.title?(s.innerHTML=t.title,FN.removeClass(r,"box_no_title"),FN.show(o)):(FN.addClass(r,"box_no_title"),FN.hide(o)),n.style.width="string"==typeof t.width?t.width:t.width+"px",n.style.height="string"==typeof t.height?t.height:t.height+"px",n.style.borderRadius="string"==typeof t.borderRadius?t.borderRadius:t.borderRadius+"px"}function m(){for(var t=u.rows[0];t.cells.length;)FN.cleanElems(t.cells[0]),t.deleteCell(0)}n=FN.ce("div",{className:"popup_box_container"+(t.dark?" box_dark":""),innerHTML:'<div class="box_layout" onclick="__bq.skip=true;">'+t.boxTitleWrap+'<div class="box_body" style="'+t.bodyStyle+'"></div><div class="box_controls_wrap"'+g+'><div class="box_controls"><table class="fl_r"><tr></tr></table><div clss="progress" id="'+t.progress+'"></div><div class="box_controls_text"></div></div></div></div>'},{display:"none"}),FN.hide(n),i=FN.domFC(n),o=FN.domFC(i),a=FN.domFC(o),t.noCloseButton&&FN.hide(a),s=FN.domNS(a),r=FN.domNS(o),l=FN.domNS(r),c=FN.domFC(l),u=FN.domFC(c),d=FN.domNS(u),h=FN.domNS(d),boxLayer.appendChild(n),_(),boxRefreshCoords(n);var v=function(){FN.isFunction(t.onClean)&&t.onClean(),FN.isFunction(t.onDestroy)&&t.onDestroy(),m(),FN.cleanElems(n,a,o,l),boxLayer.removeChild(n),delete _message_boxes[p]};return t.dark&&FN.addClass(boxLayerBG,"bg_dark"),addEvent(a,"click",__bq.hideLast),_message_boxes[p]={guid:p,_show:function(e,i,o){if(!f&&_message_boxes[p]){f=!0;!0===e||i||t.animSpeed;if(t.hideOnBGClick&&addEvent(document,"click",__bq.hideBGClick),i||layers.boxshow(),__bq.currHiding){__bq.currHiding.shOther=!0;__bq.currHiding.bodyNode.parentNode.parentNode}FN.show(n),boxRefreshCoords(n),FN.isFunction(t.onShow)&&t.onShow(o),_message_box_shown=!0}},_hide:function(e,i){if(f){f=!1;var o=!0===e?0:t.animSpeed;t.hideOnBGClick&&removeEvent(document,"click",__bq.hideBGClick),FN.isFunction(t.onBeforeHide)&&t.onBeforeHide(),_layerAnim&&!e&&layers.boxhide(),o>0?(__bq.currHiding=_message_boxes[p],FN.hide(n),s()):s()}function s(){__bq.currHiding==_message_boxes[p]&&(__bq.currHiding=!1),_layerAnim||_message_boxes[p].shOther||e||layers.boxhide(),!i&&t.selfDestruct?v():FN.hide(n),FN.isFunction(t.onHide)&&t.onHide()}},bodyNode:r,boxContainer:n,show:function(){return __bq._show(p),this},progress:d,showProgress:function(){FN.hide(h),FN.show(d)},hideProgress:function(){FN.hide(d),FN.show(h)},hide:function(e){return!(FN.isFunction(t.onHideAttempt)&&!t.onHideAttempt(e))&&(__bq._hide(p),t.dark&&FN.removeClass(boxLayerBG,"bg_dark"),!0)},isVisible:function(){return f},bodyHeight:function(){return FN.getStyle(r,"height")},content:function(e){return FN.isFunction(t.onClean)&&t.onClean(),$(r).html(e),boxRefreshCoords(n),_(),this},addButton:function(t,e,n,i){var o=function(t,e,n){"no"==n&&(n="gray"),"yes"==n&&(n="blue");var i=FN.ce("input",{className:"button_"+(n||"blue"),type:"button",value:t});return u.rows[0].insertCell(0).appendChild(i),createButton(i,e),i}(t,e||this.hide,n);return i?o:this},setButtons:function(t,e,n,i){var o=this.removeButtons();return t?(n&&o.addButton(n,i,"no"),o.addButton(t,e)):o.addButton("Закрыть")},removeButtons:function(){return m(),this},destroy:v,setOptions:function(e){if(t.hideOnBGClick&&removeEvent(document,"click",__bq.hideBGClick),t=FN.extend(t,e),"bodyStyle"in e)for(var i=t.bodyStyle.split(";"),o=0,s=i.length;o<s;++o){var a=i[o].split(":");a.length>1&&a[0].length&&(r.style[FN.trim(a[0])]=FN.trim(a[1]),r.style.setProperty&&r.style.setProperty(FN.trim(a[0]),FN.trim(a[1]),""))}return t.hideOnBGClick&&addEvent(document,"click",__bq.hideBGClick),FN.toggle(l,!t.hideButtons),_(),boxRefreshCoords(n),this}}}function showBox(t,e,n,i){if(checkEvent(i))return!1;e=e||{};var o=new MessageBox(n=n||{},n.dark),s={onDone:function(t){try{FN.show(boxLayerBG),FN.show(boxLayerWrap),o.setOptions({hideButton:e.hideButtons||!1}),n.showProgress?o.show():FN.show(o.bodyNode),o.content(t),FN.isFunction(n.onDone)&&n.onDone()}catch(t){FN.showTopMessage("Error (showBox.onDone)",5)}},onFail:function(t){if(o.failed=!0,o.hide(),FN.isFunction(n.onFail))return n.onFail(t)}};return n.showProgress?FN.extend(s,{showProgress:n.showProgress,hideProgress:n.hideProgress}):(o.setOptions({}).show(),__bq.count()<2&&FN.hide(boxLayerBG),s.showProgress=function(){FN.hide(o.boxContainer),FN.show(boxLoader),boxRefreshCoords(boxLoader)},s.hideProgress=function(){FN.hide(boxLoader),FN.show(o.boxContainer)}),$.ajax({url:t,type:"get",dataType:"html",beforeSend:function(t,e){SETTINGS.ajaxParams.beforeSend(t,e),s.showProgress()},complete:function(){s.hideProgress()},success:function(t){s.onDone(t)},error:function(t,e){SETTINGS.ajaxParams.error(t,e),s.onFail()}}),o}function showWriteMessageBox(t,e){var n=showBox(e,{},{title:"Новое сообщение",width:500,hideButtons:!0},t);return n&&cancelEvent(t),!n}function sendMessage(t){var e=FN.trim(val(FN.ge("msg_wb_text"))),n=FN.ge("message-form"),i=FN.geByAttr("name","saved_attachments","input",n);if(files_exists=i&&i.length,e.length||files_exists){if(e.length>7e3){return void showAlertBox('<span class="clr-red">Сообщение слишком длинное (до 7000 символов)</span>',"Сообщение")}$.ajax({url:t,dataType:"html",data:$(n).serialize(),beforeSend:function(t,e){SETTINGS.ajaxParams.beforeSend(t,e),lockButton("msg_wb_btn")},complete:function(){unlockButton("msg_wb_btn")},success:function(t){curBox().hide(),showTemporary("<b>Сообщение отправлено</b>")},error:function(t,e){SETTINGS.ajaxParams.error(t,e);showAlertBox('<span class="clr-red">Ошибка при отправке сообщения</span>',"Сообщение")}})}}function showSupportBox(t,e){var n=showBox(e,{},{title:"Сообщение разработчикам платформы Schools.by",width:440,hideButtons:!0},t);return n&&cancelEvent(t),!n}function sendSupportMessage(t){var e=FN.trim(val(FN.ge("support_wb_text")));if(e.length){if(e.length>2e3){return void showAlertBox('<span class="clr-red">Сообщение слишком длинное (до 2000 символов)</span>',"Сообщение")}$.ajax({url:t,data:{text:e},dataType:"html",beforeSend:function(t,e){SETTINGS.ajaxParams.beforeSend(t,e),lockButton("support_wb_btn")},complete:function(){unlockButton("support_wb_btn")},success:function(t){curBox().hide(),showTemporary("<b>Сообщение отправлено</b>")},error:function(t,e){SETTINGS.ajaxParams.error(t,e);showAlertBox('<span class="clr-red">Ошибка при отправке сообщения</span>',"Сообщение")}})}}function showTemporary(t,e){if(void 0!==t){e=e||1600;var n=FN.ce("div",{className:"temporary_box",innerHTML:t});bodyNode.appendChild(n),FN.show(n),boxRefreshCoords(n),n.style.marginLeft=FN.getSize(n)[0]/2*-1+"px",setTimeout((function(){FN.hide(n),bodyNode.removeChild(n)}),e)}}function showFastBox(t,e,n,i,o,s){return new MessageBox("string"==typeof t?{title:t}:t).content(e).setButtons(n,i,o,s).show()}function showAlertBox(t,e,n,i,o,s){showFastBox({title:e||!1,noCloseButton:!0},'<div class="alert_box_cont">'+(t=void 0===t?"":t)+"</div>",n,i,o,s)}function showBoxById(t,e){var n=FN.ge(t),i=n?n.innerHTML:"";"string"==typeof e&&(e={title:e}),e.width=e.width||540,showFastBox(e,i)}function showPhoto(t,e,n,i){if(!checkEvent(i)){var o=window.Photoview;if(o&&!1===o.showPhoto(t,e,n))return!1;return!1}}function createButton(t,e){(t=FN.ge(t))&&!t.btnevents&&(FN.hasClass(t,"button_blue")||FN.hasClass(t,"button_gray")?FN.isFunction(e)&&(t.onclick=e):t.btnevents=!0)}function lockButton(t){if((t=FN.ge(t))&&FN.hasClass(t.parentNode,"button_wrap")&&!isButtonLocked(t)){var e=t.tagName.toLowerCase(),n=FN.ce("span",{className:"button_lock"});t.parentNode.insertBefore(n,t);var i="input"===e||"button"===e?FN.getSize(t,!1):FN.getSize(t,!0);FN.setStyle(t,{width:i[0],height:i[1]}),"input"===t.tagName.toLowerCase()?(t.oldHtml=t.value,t.value=""):(t.oldHtml=t.innerHTML,t.innerHTML="")}}function unlockButton(t){if((t=FN.ge(t))&&FN.hasClass(t.parentNode,"button_wrap")){var e=FN.geByClass1("button_lock",t.parentNode);if(e)t.parentNode.removeChild(e),FN.setStyle(t,{width:"auto",height:"auto"}),"input"===t.tagName.toLowerCase()?t.value=t.oldHtml:t.innerHTML=t.oldHtml}}function isButtonLocked(t){if(t=FN.ge(t))return!!FN.geByClass1("button_lock",t.parentNode)}function val(t,e,n){if(t=FN.ge(t))return void 0!==e&&(t.setValue?(t.setValue(e),!n&&t.phonblur&&t.phonblur()):"INPUT"==t.tagName||"TEXTAREA"==t.tagName?t.value=e:t.innerHTML=e),t.getValue?t.getValue():("INPUT"==t.tagName||"TEXTAREA"==t.tagName?t.value:t.innerHTML)||""}function inherits(t,e){var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.superclass=e.prototype}function doFullVersion(){return $.cookie("force_full_version","1",{domain:LOC.domain,path:"/",expires:30}),!1}function doMobileVersion(){return $.cookie("force_full_version","",{domain:LOC.domain,path:"/",expires:30}),!1}function onBodyResize(t){var e=window,n=document.documentElement;if(e.pageNode){var i=Math.max(FN.intval(e.innerWidth),FN.intval(n.clientWidth)),o=Math.max(FN.intval(e.innerHeight),FN.intval(n.clientHeight)),s=FN.sbWidth();if(BROWSER.mobile||(BROWSER.msie7?htmlNode.scrollHeight>htmlNode.offsetHeight&&!layers.visible&&(i+=s+1):BROWSER.msie8&&htmlNode.scrollHeight+3>htmlNode.offsetHeight&&!layers.visible&&(i+=s+1)),!e.lastWindowWidth||e.lastWindowWidth!==i||!0===t){!0,e.lastInnerWidth=e.lastWindowWidth=i,layerWrap.style.width=boxLayerWrap.style.width=i+"px";layer.style.width=boxLayer.style.width=i-s-2+"px";if(!BROWSER.mobile&&i)for(var a=pageNode.firstChild;a;a=a.nextSibling)if(a.tagName)for(var r=a.firstChild;r;r=r.nextSibling)FN.hasClass(r,"scroll_fix")&&(r.style.width=(e.lastInnerWidth=i-s*(BROWSER.msie7?2:1)-1)-1+"px")}e.lastWindowHeight&&e.lastWindowHeight===o&&!0!==t||(!0,e.lastWindowHeight=o,layerBG.style.height=boxLayerBG.style.height=layerWrap.style.height=boxLayerWrap.style.height=o+"px",BROWSER.mobile||BROWSER.mozilla&&layers.visible&&(pageNode.style.height=_oldScroll+o+"px"))}}function domStarted(){window.headNode=FN.geByTag1("head"),window.htmlNode=FN.geByTag1("html"),window.bodyNode=document.body,window.loader='<div class="loader"></div>',window.overlay=FN.ge("overlay"),FN.extend(window,{layerBG:FN.ge("layer_bg"),layerWrap:FN.ge("layer_wrap"),layer:FN.ge("layer"),boxLayerBG:FN.ge("box_layer_bg"),boxLayerWrap:FN.ge("box_layer_wrap"),boxLayer:FN.ge("box_layer"),boxLoader:FN.ge("box_loader")}),addEvent(boxLayerWrap,"click",__bq.hideLastCheck),FN.extend(layers,{show:layers._show.pbind(layerBG,layerWrap),boxshow:layers._show.pbind(boxLayerBG,boxLayerWrap),wrapshow:layers._show.pbind(layerBG),hide:layers._hide.pbind(layerBG,layerWrap),boxhide:layers._hide.pbind(boxLayerBG,boxLayerWrap),wraphide:layers._hide.pbind(layerBG)}),BROWSER.mobile&&BROWSER.chrome&&FN.addClass(bodyNode,"chrome")}function domReady(){window.pageNode=FN.ge("page_wrap"),window.scrollNode=BROWSER.chrome||BROWSER.safari?bodyNode:htmlNode,window.footerNode=FN.ge("footer"),onBodyResize(),setInterval((function(){bodyNode.onresize||(bodyNode.onresize=onBodyResize.pbind(!1))}),1e3),BROWSER.msie&&BROWSER.version<9&&bodyNode.insertBefore(FN.ce("div",{className:"old_browser_message",innerHTML:'Вы используете устаревший браузер. Пожалуйста, <a href="http://browsehappy.com/">обновите ваш браузер</a>.<br>Пользоваться Интернетом вам станет намного приятнее :)'}),pageNode)}function insert_objects_data_in_form(t,e){for(var n in e){var i=e[n];for(var o in i)if(i.hasOwnProperty(o)){var s=document.createElement("input");s.setAttribute("type","hidden"),s.setAttribute("name",n.toString()+"."+o),s.setAttribute("value",i[o]||""),t.appendChild(s)}}}__bq.hideLastCheck=__bq.hideLast.pbind(!0),BROWSER.mobile||addEvent(document,"keydown",(function(t){if(t.keyCode===KEY.ESC&&__bq.count())return __bq.hideLast(),-1})),addEvent(window,"orientationchange",onBodyResize),$((function(){var t=$("body"),e=$("#page_wrap"),n=$("#js-finevision-settings"),i=".itable, .jpop",o=e.find("div,span,h1,h2,h3,h4,h5,h6,p,blockquote,li,a,sub,sup,small,table,th,td,dt,dd,form,input,textarea,select,option,label,button").filter((function(){return!$(this).closest(i).length&&!$(i).is(this)})),s={color:"white",fontSizeCounter:2,lineHeightCounter:2,imageType:"gray"},a={color:null,fontSizeCounter:0,lineHeightCounter:0,imageType:null};function r(){t.addClass("finevision"),h("font-size"),h("line-height");var e=_.defaults(g(),s);u(e.color),l(e.fontSizeCounter),c(e.lineHeightCounter),d(e.imageType),n.show(),!0}function l(t){if(!(t<0||t>4)){p("font-size",2*t,{min:12,max:36}),a.fontSizeCounter=t,f(a)}}function c(t){if(!(t<0||t>6)){p("line-height",2*t),a.lineHeightCounter=t,f(a)}}function u(e){t.removeClass("finevision-white"),t.removeClass("finevision-black"),t.removeClass("finevision-blue"),t.removeClass("finevision-brown"),a.color=null,f(a),t.addClass("finevision-"+e),a.color=e,f(a)}function d(e){t.removeClass("finevision-img-hidden"),t.removeClass("finevision-img-gray"),t.removeClass("finevision-img-color"),a.imageType=null,f(a),t.addClass("finevision-img-"+e),a.imageType=e,f(a)}function h(t){o.each((function(){var e=$(this),n=parseFloat(e.css(t));e.attr("fv-initial-"+t,n)}))}function p(t,e,n){n=n||{},o.each((function(){var i=$(this),o=(parseFloat(i.attr("fv-initial-"+t))||12)+e;n.min&&(o=Math.max(o,n.min)),n.max&&(o=Math.min(o,n.max)),i.attr("fv-"+t,o)})),o.each((function(){var e=$(this),n=e.attr("fv-"+t);e.css(t,n+"px")}))}function f(t){window.sessionStorage.setItem("finevison",JSON.stringify(t))}function g(){var t,e=window.sessionStorage.getItem("finevison");try{t=JSON.parse(e)}catch(t){}return t}g()&&r(),window.FINEVISION={activate:r,deactivate:function(){window.sessionStorage.removeItem("finevison"),location.reload()},changeFontSize:function(t){l(a.fontSizeCounter+t)},changeLineHeight:function(t){c(a.lineHeightCounter+t)},setColor:u,setImageType:d}})),window.MARKS_HELPER={convertMark:function(t){return null==t?"":t.toString().replace(/-1/i,"н").replace(/-2/i,"з.").replace(/-3/i,"н/з").replace(/-4/i,"н/а").replace(/-5/i,"осв.").replace(/-6/i,"—")},reconvertMark:function(t){return null==t?"":t.toString().replace(/&nbsp;/i,"").replace(/н\/а/i,"-4").replace(/осв./i,"-5").replace(/н\/з/i,"-3").replace(/з./i,"-2").replace(/н/i,"-1").replace(/—/i,"-6")},getMarksInfo:function(t,e){var n=this.valuableMarks(t),i=this.valuableMarks(e),o=t.concat(e),s=n.concat(i),a=_.filter(o,(function(t){return-1===t||-6===t})).length,r=o.length-a,l=this.averageMark(s),c=this.getRatingByHighestMark(n,i),u=this.getRatingByPrevailingMark(n,i);return{skips:a,count:r,avg:l,highest:null!==c?Math.round(c):null,prevailing:null!==u?Math.round(u):null}},roundMark:function(t){return Math.round(100*t)/100},isValuableMark:function(t){return null!=t&&(t>=0&&t<=10)},valuableMarks:function(t){return _.filter(t,(function(t){return null!=t&&t>=0&&t<=10}))},averageMark:function(t){if(!t.length)return null;var e=_.reduce(t,(function(t,e){return t+e}),0);return this.roundMark(e/t.length)},flattenMarks:function(t){var e=[];return _.each(t,(function(t){var n=(t||"").toString().split("/");_.each(n,(function(t){var n=parseInt(t,10);(n||0===n)&&e.push(n)}))})),e},getRatingByHighestMark:function(t,e){if(!e.length)return this.averageMark(t);if(!t.length)return this.averageMark(e);var n=this._getHighestMark(t),i=null!==n?n:this.averageMark(t),o=e.concat(i);return this.averageMark(o)},getRatingByPrevailingMark:function(t,e){if(!e.length)return this.averageMark(t);if(!t.length)return this.averageMark(e);var n=this._getPrevailingMark(t),i=null!==n?n:this.averageMark(t),o=e.concat(i);return this.averageMark(o)},_getHighestMark:function(t){if(!t.length)return null;var e=t[0];return _.each(t,(function(t){e=Math.max(e,t)})),e},_getPrevailingMark:function(t){if(!t.length)return null;var e={};_.each(t,(function(t){e[t]?e[t].count+=1:e[t]={mark:t,count:1}}));var n=null,i=0;return _.each(e,(function(t){i<t.count?(n=t.mark,i=t.count):i===t.count&&(n=null)})),n}};var Photoview={$phList:$("#photos_container a"),onResize:function(){CURRENT.pvCont&&Photoview.updateArrows()},updateArrows:function(){var t=$(CURRENT.pvCont).offset().left,e=$(CURRENT.pvCont).width()+t,n=$(layer).width()-e;$(CURRENT.pvBox).height();$(CURRENT.pvLeftNav).show().width(t-1),$(CURRENT.pvRightNav).show().width(n).css("left",e+1+"px").css("right","auto"),Photoview.$phList.length<2&&$(CURRENT.pvLeftNav).find("span").hide()},doShow:function(t,e){Photoview.$phList=e,!0!==Photoview.checkLayerVisibility()&&Photoview.createLayer(),CURRENT.pvIndex=t,Photoview.showPhoto(t),Photoview.updateArrows()},showPhoto:function(t){t<0?CURRENT.pvIndex=Photoview.$phList.length-1:t>Photoview.$phList.length-1?CURRENT.pvIndex=0:CURRENT.pvIndex=t;var e=Photoview.$phList.eq(CURRENT.pvIndex).attr("href"),n=Photoview.getPhotoID(Photoview.$phList.eq(CURRENT.pvIndex));CURRENT.pvBox.innerHTML=loader,Photoview.updateArrows(),$.ajax({type:"get",dataType:"text",url:e,success:function(t){$(CURRENT.pvBox).html(t),Photoview.updateArrows(),FN.show(layer),$("#curPvIndex").html(CURRENT.pvIndex+1),$("#pvLength").html(Photoview.$phList.length)}}),window.location.href=window.location.href.split("#")[0]+"#photo"+n},hide:function(){return CURRENT.pvShown=!1,history&&history.replaceState("","",window.location.href.split("#")[0]),layers.hide(),!1},getPhotoID:function(t){return t.attr("href").split("#")[0].split("?")[0].split("/").pop()},getListByRel:function(t){return $('a[href*="/photo/"][rel="'+t+'"]')},createLayer:function(){layer.innerHTML='<div class="pv_cont"><div id="pv_box">\n\n</div></div><div id="pv_left_nav" class="pv_prev_nav"><span></span></div><div id="pv_right_nav" class="pv_close_nav" onclick="Photoview.hide();"><span></span></div>',FN.extend(CURRENT,{pvIndex:1,pvCont:FN.domFC(layer),pvBox:FN.ge("pv_box"),pvLeftNav:FN.ge("pv_left_nav"),pvRightNav:FN.ge("pv_right_nav"),pvSummary:FN.domFC(FN.ge("pv_summary")),pvPhoto:FN.ge("pv_photo")})},checkLayerVisibility:function(){var t=FN.isVisible(layerWrap);if(t&&!CURRENT.pvShown&&(layers.fullhide&&layers.fullhide(!1,!0),t=!1),t)return!0;addEvent(window,"resize",Photoview.onResize),boxQueue.hideAll(),layers.show()},init:function(){$('a[href*="/photo/"]:not([href*="/delete"])').on("click",(function(){var t,e=$(this),n=Photoview.getPhotoID(e);if(1==n)return!0;if(t=Photoview.getListByRel(e),e.is("[rel]")&&e.attr("rel")){var i=e.attr("rel");t=$('a[href*="/photo/"][rel="'+i+'"]')}var o=0,s=0;for(s=0;s<t.length;s++){var a=t.eq(s);Photoview.getPhotoID(a)==n&&(o=s)}return Photoview.doShow(o,t),!1})),$('a[href*="#photo"]').on("click",(function(){return clickActiveAnchor($(this).attr("href").split("#")[1]),!1})),$("body").on("click",'a[href*="/photo/"][href*="/delete"]',(function(t){if(confirm("Вы уверены?")){var e=$(this),n=e.attr("href");n?$.ajax({type:"get",dataType:"text",url:n,success:function(t){var n=e.attr("href").split("/delete")[0],i=Photoview.$phList.filter('[href="'+n+'"]'),o=i.attr("rel");if(i.hasClass("profile-photo")){var s=i.next().filter('[rel="'+o+'"]');s.length?(i.attr("href",s.attr("href")),s.remove()):i.removeAttr("rel").removeAttr("href"),i.find("img").attr("src","/data/nopicture.w150.jpg")}else i.remove();Photoview.$phList=Photoview.getListByRel(o),Photoview.$phList.length<1?Photoview.hide():Photoview.showPhoto(CURRENT.pvIndex)}}):FN.showTopMessage("Ошибка",4)}t.preventDefault()})),$("body").on("click",".pv_prev_nav",(function(){Photoview.$phList.length<2&&Photoview.hide();var t=parseInt(CURRENT.pvIndex)-1;return Photoview.showPhoto(t),!1})),$("body").on("click",".pv_next_nav",(function(){Photoview.$phList.length<2&&Photoview.hide();var t=parseInt(CURRENT.pvIndex)+1;return Photoview.showPhoto(t),!1}))}},AttachmentsDropdown=function(t){this.container=FN.ge(t.container),this.container?(this.toggle_link=FN.ge(t.toggle_link),this.toggle_link?(this.menu_container=FN.ge(t.menu_container),this.menu_container?(this.isAjax="false"!==this.toggle_link.getAttribute("data-ajax"),this.isLoaded=!1,this.isOpen=!1,this.attachEvent(),this.container.initialized=!0,AttachmentsDropdown.objects_list.push(this)):FN.log("AttachmentsDropdown: не задан выпадающий элемент")):FN.log("AttachmentsDropdown: не задан toggle-элемент")):FN.log("AttachmentsDropdown: не задан контейнер")};AttachmentsDropdown.objects_list=[],AttachmentsDropdown.prototype.classNames={container:"attachments_dropdown",toggle_link:"attachments_dropdown_toggle",menu_container:"attachments_dropdown_menu"},AttachmentsDropdown.prototype.toggle=function(){this.isOpen?this.hide():this.isAjax&&!this.isLoaded?(this.show(),this.load()):this.show()},AttachmentsDropdown.prototype.show=function(){AttachmentsDropdown.hideAll(),FN.addClass(this.container,"open"),this.isOpen=!0},AttachmentsDropdown.prototype.hide=function(){FN.removeClass(this.container,"open"),this.isOpen=!1},AttachmentsDropdown.prototype.load=function(){var t=this,e=this.toggle_link.getAttribute("href");e?(this.menu_container.innerHTML=loader,$.ajax({type:"get",dataType:"html",url:e,success:function(e){t.menu_container.innerHTML=e,t.isLoaded=!0},complete:function(){}})):FN.log("AttachmentsDropdown: url не задан")},AttachmentsDropdown.prototype.attachEvent=function(){var t=this,e=AttachmentsDropdown;addEvent(this.toggle_link,"click",(function(e,n){return t.toggle(),!1})),addDocumentOutsideClick("attachments","dropdown",(function(){e.hideAll()}))},AttachmentsDropdown.initAll=function(t){var e=AttachmentsDropdown.prototype.classNames,n=t&&FN.ge(t)||document,i=FN.geByClass(e.container,n,"div");FN.each(i,(function(t,n){n.initialized||new AttachmentsDropdown({container:n,toggle_link:FN.geByClass1(e.toggle_link,n,"a"),menu_container:FN.geByClass1(e.menu_container,n,"div")})}))},AttachmentsDropdown.hideAll=function(){var t=AttachmentsDropdown.objects_list;FN.each(t,(function(t,e){e.hide()}))};var Comments=function(t){this.container_list=FN.ge(t.container_list),this.container_list?(this.form=FN.ge(t.form),this.form&&(this.textarea=FN.geByTag1("textarea",this.form)),this.type=t.type,this.url_last=t.url_last,this.url_all=t.url_all,this.attachEvents()):FN.log("Comments: не задан контейнер для загрузки последних комментариев")};Comments.deleteItem=function(t,e){},Comments.prototype.loadLast=function(){var t=this,e=this.container_list,n=this.url_last;e.innerHTML=loader,$.ajax({url:n,type:"get",dataType:"text",success:function(n){if(n){e.innerHTML=n;var i=FN.geByAttr1("data-link","show-all","a",t.container_list);t.link_show_all=i,addEvent(i,"click",(function(){t.loadAll()}))}else e.innerHTML='<div class="clr-red">Ошибка</div>'}})},Comments.prototype.loadAll=function(){var t=this.container_list,e=this.link_show_all,n=this.url_all;e&&(e.parentNode.innerHTML=loader),$.ajax({url:n,type:"get",dataType:"text",success:function(e){t.innerHTML=e||'<div class="clr-red">Ошибка</div>'}})},Comments.prototype.attachEvents=function(){var t=this,e=this.form,n=this.textarea;e&&addEvent(e,"submit",(function(){return t.saveItem(),!1})),n&&addEvent(n,"keydown",(function(e){e.ctrlKey&&e.keyCode===KEY.ENTER&&(t.saveItem(),n.focus())}))},Comments.prototype.saveItem=function(){var t=this,e=this.container_list,n=this.form,i=this.textarea;if(n)if(i){var o=n.getAttribute("action"),s=FN.trim(i.value);if(!s||""===s)return!1;$.ajax({url:o,dataType:"text",data:$(n).serialize(),success:function(n){n?(t.appendItem(n),i.value=""):e.innerHTML='<div class="clr-red">Ошибка</div>'}})}else FN.log("Comments.prototype.saveItem: не задан textarea для отправки комментария");else FN.log("Comments.prototype.saveItem: не задана форма для отправки комментария")},Comments.prototype.appendItem=function(t){var e=this.container_list,n=this.type,i=$(t);if("comments"===n)$(e).append(i);else $(e).prepend(i);i.filter("div:first").hide().slideDown(300);var o=FN.geByAttr1("data-element","empty","div",e);o&&e.removeChild(o)};var Filter=function(t){var e=FN.extend({menu_id:"",container_id:"",display:"block",items_tag:"div"},t);this.options=e,this.menu=FN.ge(e.menu_id),this.menu?(this.menu.items=FN.geByTag("li",this.menu),this.menu.items&&this.menu.items.length?(this.menu.links=FN.geByTag("a",this.menu),this.menu.links&&this.menu.links.length?(this.container=FN.ge(e.container_id),this.container?(this.items=FN.geByAttr("data-filter",null,e.items_tag,this.container),this.items&&this.items.length?(this._prepare(),this.attachEvents()):FN.log("Ошибка при инициализации фильтра: не заданы элементы для фильтрации :(")):FN.log("Ошибка при инициализации фильтра: не задан контейнер :(")):FN.log("Ошибка при инициализации фильтра: нет a-элементов в меню :(")):FN.log("Ошибка при инициализации фильтра: нет li-элементов в меню :(")):FN.log("Ошибка при инициализации фильтра: меню не задано :(")};Filter.prototype._prepare=function(){FN.each(this.menu.links,(function(t,e){e.data_filter=e.getAttribute("data-filter")})),FN.each(this.items,(function(t,e){e.data_filter=e.getAttribute("data-filter")}))},Filter.prototype.switchMenu=function(t){FN.each(this.menu.items,(function(t,e){FN.removeClass(e,"active")})),FN.addClass(t.parentNode,"active")},Filter.prototype.toggle=function(t){var e=this.options.display;"all"===t.data_filter?FN.each(this.items,(function(t,n){n.style.display=e})):FN.each(this.items,(function(n,i){i.data_filter===t.data_filter?i.style.display=e:i.style.display="none"}))},Filter.prototype.attachEvents=function(){var t=this;FN.each(this.menu.links,(function(e,n){addEvent(n,"click",(function(){t.switchMenu(n),t.toggle(n)}))}))};var Poll=function(t){this.container=FN.ge(t.container),this.container?(this.form=FN.ge(t.form)||null,this.result_container=FN.ge(t.result_container)||null,this.total_container=FN.ge(t.total_container)||null,this.attachEvents()):FN.log("Poll: контейнер не задан")};Poll.prototype.vote=function(){var t=this,e=(this.container,this.form),n=this.result_container;if(e){var i=e.getAttribute("action");i&&""!==i?$.ajax({url:i,data:$(e).serialize(),success:function(i){n?(n.innerHTML=t.getResultHtml(i),n.style.display="block",e.parentNode.removeChild(e)):FN.log("Poll.prototype.vote: контейнер для результатов не задан")}}):FN.log("Poll.prototype.vote: url отправки формы не задан")}else FN.log("Poll.prototype.vote: форма не задана")},Poll.prototype.getResultHtml=function(t){var e="",n=t.total;FN.each(t.options,(function(t,i){var o=i.fields.count,s=FN.toFixed(o/n*100,2),a=i.fields.name;e+="<dl><dt><b>"+s+"%</b><small>("+o+")</small></dt><dd>"+a+'<div class="percent"><i style="width:'+s+'%"></i></div></dd></dl>'})),e+='<div class="success">Спасибо за ваше мнение!</div>';var i=this.total_container;if(i){var o=FN.geByAttr1("data-total","count","b",i);o&&(o.innerHTML=n),e+=i.outerHTML}return e},Poll.prototype.attachEvents=function(){var t=this,e=this.form;e&&addEvent(e,"submit",(function(){return t.vote(),!1}))};var Tabs=function(t){t=FN.extend({menu_id:"",content_id:"",content_class_name:"",speed:500,scroll_container_id:"",scroll_position:"top",open_first:!1},t);var e=this;FN.each(["onCreate","onBefore","onAfter","onCloseBefore","onCloseAfter"],(function(n,i){var o=t[i];FN.isFunction(o)&&(e[i]=o)})),this.menu=FN.ge(t.menu_id),this.menu?(this.menu.items=FN.geByTag("li",this.menu),this.menu.items&&this.menu.items.length?(this.menu.links=FN.geByTag("a",this.menu),this.menu.links&&this.menu.links.length?(this.content=FN.ge(t.content_id),this.content?(this.content.items=FN.geByClass(t.content_class_name,this.content),this.content.items&&this.content.items.length?(this.speed=t.speed,this.scroll_container=FN.ge(t.scroll_container_id),this.scroll_position=t.scroll_position,this.attachEvents(),t.open_first?this.openByHashOrFirst():this.openByHash()):FN.log("Ошибка при инициализации табов: нет элементов с содержанием табов :(")):FN.log("Ошибка при инициализации табов: блок с контентом для табов не задан :(")):FN.log("Ошибка при инициализации табов: нет a-элементов в меню табов :(")):FN.log("Ошибка при инициализации табов: нет li-элементов в меню табов :(")):FN.log("Ошибка при инициализации табов: меню для табов не задано :(")};Tabs.prototype.onCreate=function(){},Tabs.prototype.onBefore=function(){},Tabs.prototype.onAfter=function(){},Tabs.prototype.onCloseBefore=function(){},Tabs.prototype.onCloseAfter=function(){},Tabs.prototype.toggle=function(t){t?FN.hasClass(t.parentNode,"active")?this.hide(t):this.show(t):FN.log("Ошибка при toggle таба: ссылка не передана")},Tabs.prototype.show=function(t){this._show_or_hide(t,"show")},Tabs.prototype.hide=function(t){this._show_or_hide(t,"hide")},Tabs.prototype._show_or_hide=function(t,e){if(t){var n=t.getAttribute("for");if(n){var i=FN.ge(n);if(i)switch(e){case"show":this._show(t,i);break;case"hide":this._hide(t,i)}else FN.log("Ошибка при открытии таба: dom-элемент единицы контента не задан")}else FN.log("Ошибка при открытии таба: id единицы контента не задан")}else FN.log("Ошибка при открытии таба: ссылка не передана")},Tabs.prototype._hide=function(t,e){var n=this;this.onCloseBefore(),$(e).stop().slideUp(this.speed,(function(){n._changeActiveMenuItem(),n.onCloseAfter()}))},Tabs.prototype._show=function(t,e){this.onBefore(),this._changeActiveMenuItem(t),FN.each(this.content.items,(function(t,e){FN.hide(e)}));var n=t.getAttribute("src");n&&""!==n?this._load_and_show(t,e):this._openContainer(e)},Tabs.prototype._scrollToVisible=function(){var t=this.scroll_container,e=this.scroll_position;this.scroll_container?this._scrollToVisible=function(){var n=FN.getSize(t)[1],i=window.lastWindowHeight,o=!0;o=n&&i?n>i:"top"===e,t.scrollIntoView(o)}:this._scrollToVisible=function(){return!1},this._scrollToVisible()},Tabs.prototype._load_and_show=function(t,e){var n=this,i=$(e);e.innerHTML=loader,FN.show(e),$.ajax({type:"get",dataType:"text",url:t.getAttribute("src"),success:function(o){FN.hide(e),i.html(o),n._openContainer(i),t.setAttribute("src","")}})},Tabs.prototype._openContainer=function(t){var e=this,n=this.speed;n?$(t).stop().slideDown(n,(function(){e.onAfter()})):($(t).show(),e.onAfter())},Tabs.prototype._changeActiveMenuItem=function(t){FN.each(this.menu.items,(function(t,e){FN.removeClass(e,"active")})),t&&FN.addClass(t.parentNode,"active")},Tabs.prototype.attachEvents=function(){var t=this;FN.each(this.menu.links,(function(e,n){addEvent(n,"click",(function(){t.toggle(n)}))}))},Tabs.prototype.openByHashOrFirst=function(){if(LOC.hash)this.openByHash();else{var t=this.menu.links[0];this.toggle(t)}},Tabs.prototype.openByHash=function(){if(LOC.hash){var t=FN.geByAttr1("href","#"+LOC.hash,"a",this.menu);t&&this.show(t)}};var classSubjectsEditor={last_active_subject:{},init:function(){this.container=FN.ge("edit_class_subjects"),this.popup=FN.ge("popup_teachers"),this.popup.height=FN.getSize(this.popup)[1],FN.setStyle(this.container,"min-height",this.popup.height+"px"),this.clear_last_subject()},clear_last_subject:function(){this.set_last_subject(void 0,void 0)},set_last_subject:function(t,e){this.last_active_subject={id:t,subgroup_index:e}},clear:function(){var t=$("#edit_class_subjects");t.find("input[name*=teacher_id]").val(""),t.find("input[name*=ClassSubjectSubgroupTeacher]").val(""),t.find("select[name*=ClassSubjectSubgroupTeacher]").val(""),t.find(".teacher a").text("Не выбрано"),t.find(".teachers_group__no_subgroups").removeClass("hidden"),t.find(".teachers_group__by_subgroups").addClass("hidden")},addSubgroups:function(t){var e=FN.ge("subgroups_teachers_group_"+t),n=FN.ge("class_subject_subgroup_add_link_"+t);return FN.removeClass(e,"hidden"),FN.hide(n),!1},openTeachersPopup:function(t,e,n){this.showPopup(t,this.popup),this.set_last_subject(e,n)},showPopup:function(t,e){var n=this.container;n.height=FN.getSize(n)[1];var i=FN.getXY(t)[1]-FN.getXY(n)[1];i=(i=e.height+i>n.height?i-e.height-7:i+20)<20?20:i;FN.setStyle(e,{top:i+"px",left:"50px"}),this.hidePopup(),$(e).show(250)},hidePopup:function(){this.clear_last_subject(),this.popup.style.display="none"},changeTeacher:function(t,e){var n=this.last_active_subject.id,i=this.last_active_subject.subgroup_index,o="class_subject_teacher_link_"+n,s="class_subject_teacher_input_"+n;void 0!==i&&(o+="-"+i,s+="-"+i);var a=FN.ge(o),r=FN.ge(s);a.innerHTML=e,a.innerText=e,r.value=t||"",this.justChanged(n,i),this.hidePopup()},justChanged:function(t,e){var n=void 0!==e?t+"-"+e:t,i=FN.ge("class_subject_teacher_link_"+n);FN.removeClass(i,"not_assigned"),FN.addClass(i,"just_changed")}},classTimetableEditor={last_active_lesson:{},init:function(){this.container=FN.ge("edit_class_timetable"),this.popup_class_subjects=FN.ge("popup_class_subjects"),this.popup_subgroups_subjects=FN.ge("popup_subgroups_subjects"),this.popup_class_subjects.height=1*FN.getSize(this.popup_class_subjects)[1],this.popup_class_subjects.width=1*FN.getSize(this.popup_class_subjects)[0],this.popup_subgroups_subjects.height=1*FN.getSize(this.popup_subgroups_subjects)[1],this.popup_subgroups_subjects.width=1*FN.getSize(this.popup_subgroups_subjects)[0],this.popups_max_height=Math.max(this.popup_cs_height,this.popup_ss_height),FN.setStyle(this.container,"min-height",this.popups_max_height+"px"),this.clear_last_lesson()},clear_last_lesson:function(){this.set_last_lesson()},set_last_lesson:function(t,e,n){this.last_active_lesson={day_number:t,lesson_number:e,loop_count:n}},doBySubgroups:function(t,e){if(confirm("Вы уверены, что хотите сделать урок по подгруппам?")){FN.ge("edit_ctt_lesson_subjects_"+t+"-"+e).innerHTML="",this.addSubgroup(t,e),this.justChanged(t,e,1);var n=this.getIndex(t,e);FN.show("edit_ctt_add_subgroup_link_"+n),FN.show("edit_ctt_undo_by_subgroups_link_"+n),FN.hide("edit_ctt_do_by_subgroups_link_"+n)}},undoBySubgroups:function(t,e){if(confirm("Вы уверены, что хотите сделать урок НЕ по подгруппам?")){var n=this.getIndex(t,e),i=FN.ce("div",{className:"lesson_subject",innerHTML:this._getSubjectHtml(t,e)}),o=FN.ge("edit_ctt_lesson_subjects_"+n);o.innerHTML="",o.appendChild(i),this.justChanged(t,e);var s=this.getIndex(t,e);FN.hide("edit_ctt_add_subgroup_link_"+s),FN.hide("edit_ctt_undo_by_subgroups_link_"+s),FN.show("edit_ctt_do_by_subgroups_link_"+s)}},addSubgroup:function(t,e){var n=this.getIndex(t,e),i=FN.ge("edit_ctt_lesson_subjects_"+n),o=FN.geByClass("lesson_subject",i,"div").length+1,s=FN.ce("div",{className:"lesson_subject",innerHTML:this._getSubjectHtml(t,e,o)});i.appendChild(s),this.justChanged(t,e,o)},_getSubjectHtml:function(t,e,n){var i=void 0!==n,o=t+"-"+e;i&&(o+="-"+n);var s="";return s+='<input type="hidden" name="'+o+'.day" value="'+t+'"/>',s+='<input type="hidden" name="'+o+'.number" value="'+e+'"/>',s+='<input type="hidden" name="'+o+'.class_subject_id" value=""/>',s+=i?'<input type="hidden" name="'+o+'.subgroup_id" value=""/>':"",s+='<span class="edit_ctt_cabinet">каб.<input class="text" type="text" name="'+o+'.cabinet" value="" maxlength="10" /></span>',s+='<span class="edit_ctt_subject"><a id="edit_ctt_subject_'+o+'" not-hide="subjects_popup" class="not_assigned"onclick="'+(i?"classTimetableEditor.openSubgroupsSubjectsPopup(this, "+t+", "+e+", "+n+")":"classTimetableEditor.openClassSubjectsPopup(this, "+t+", "+e+")")+'">Не выбрано</a></span>'},openClassSubjectsPopup:function(t,e,n){this.showPopup(t,this.popup_class_subjects),this.set_last_lesson(e,n)},openSubgroupsSubjectsPopup:function(t,e,n,i){this.showPopup(t,this.popup_subgroups_subjects),this.set_last_lesson(e,n,i)},showPopup:function(t,e){var n=this.container;n.height=FN.getSize(n)[1],n.width=FN.getSize(n)[0];var i=FN.getXY(t)[1]-FN.getXY(n)[1];i=(i=e.height+i>n.height?i-e.height-7:i+20)<20?20:i;var o=FN.getXY(t)[0]-FN.getXY(n)[0];o=(o=e.width+o>n.width?n.width-e.width-10:o)<0?0:o,FN.setStyle(e,{top:i+"px",left:o+"px"}),this.hidePopups(),$(e).show(250)},hidePopups:function(){this.clear_last_lesson(),this.popup_class_subjects.style.display="none",this.popup_subgroups_subjects.style.display="none"},changeSubject:function(t,e){var n=this.last_active_lesson.day_number,i=this.last_active_lesson.lesson_number,o=this.last_active_lesson.loop_count,s=this.getIndex(n,i,o);FN.geByAttr1("name",s+".class_subject_id","input",this.container).value=t.id;var a=FN.ge("edit_ctt_subject_"+s);if(a.innerHTML=t.name,this.justChanged(n,i,o),void 0!==o){FN.geByAttr1("name",s+".subgroup_id","input",this.container).value=e.id;var r=FN.ce("span",{innerHTML:e.name?"("+e.name+")":""});a.appendChild(r)}this.hidePopups()},clear:function(){var t=$("#edit_class_timetable");t.find("input[name*='class_subject_id']").val(""),t.find("input[name*='subgroup_id']").val(""),t.find("input[name*='cabinet']").val(""),t.find(".edit_ctt_subject a").each((function(){var t=$(this);"Не выбрано"!==$.trim(t.text())&&(t.text("Не выбрано"),t.addClass("just_changed"))}))},justChanged:function(t,e,n){var i=this.getIndex(t,e,n),o=FN.ge("edit_ctt_subject_"+i);FN.removeClass(o,"not_assigned"),FN.addClass(o,"just_changed")},getIndex:function(t,e,n){var i=t+"-"+e;return void 0!==n&&(i+="-"+n),i}};$(document).ready((function(){$("#mess_tabs2 a").click((function(){var t=this.className;$("#mess_tabs2 li").removeClass("act"),$(this).parent().addClass("act"),$("#messages_list .messages_group").hide(),$("#messages_list #"+t).show()})),$("#messages_list .messages_group").each((function(){var t=$(this),e=$(".message_row.no_viewed",t).length;if(e){var n=$("#mess_tabs2 a."+t.attr("id"));n.html(n.html()+" (<b>"+e+"</b>)")}})),0==$("#fromGlobalAdmin .one-message").length&&$(".messages-tabs li:last").hide(),$("a.more_mess_link").on("click",(function(){var t=$(this),e=t.attr("currCount");return $.ajax({url:t.attr("href")+"?already_loaded_count="+e,type:"get",dataType:"text",success:function(n){var i=t.parent();i.before(n);var o=i.parent(),s=o.find("input[name=count]").attr("value");(e=o.find("div.message_row").length)==s?i.remove():t.attr("currCount",e)}}),!1})),$("a#mess_history_link").click((function(){var t=$(this),e=$("#mess_history");return t.parent().html('<img src="/images/upload.gif" alt="Загрузка..."/>'),$.ajax({type:"get",dataType:"html",url:t.attr("href"),success:function(t){e.html(t)}}),!1}))}));var Attachments=function(t){this.filename={no_name:"no name",maxStartLength:14,maxEndLength:8},this.autostartOn=!0,this.maxFilesCount=!1,this.dataType="text",this.fieldName="attachments",this.url=t.url,this.url?(this.file_input=FN.ge(t.file_input),this.container=FN.ge(t.container),this.list_container=FN.ge(t.list_container),this.initUploader(),this.attachUploaderEvents()):FN.log("Attachments: URL не задан")};Attachments.prototype.initUploader=function(){$(this.file_input).damnUploader({url:this.url,limit:this.maxFilesCount,dataType:this.dataType,fieldName:this.fieldName})},Attachments.prototype.attachUploaderEvents=function(){var t=this;$(this.file_input).on({"du.add":function(e){t.fileAddHandler(e)},"du.limit":function(){FN.log("Превышено максимально допустимое количество файлов!")},"du.completed":function(){FN.log("Все загрузки завершены!")}})},Attachments.prototype.isTextFile=function(t){return"text/plain"==t.type},Attachments.prototype.isImgFile=function(t){return t.type.match(/image.*/)},Attachments.prototype.nomalizeFileName=function(t){var e=t;if(!e||!e.length)return this.filename.no_name;var n=this.filename.maxStartLength,i=this.filename.maxEndLength;return e.length>n+i+3?e.substring(0,n)+"<small>...</small>"+e.substring(e.length-i):e},Attachments.prototype.fileAddHandler=function(t){var e=t.uploadItem;e.file.name||this.filename.no_name;this.createRowFromUploadItem(e),e.completeCallback=function(t,n,i){if(t)e.row.innerHTML=n,e.row.deleteLink=FN.geByClass1("file_delete",e.row,"a"),addEvent(e.row.deleteLink,"click",(function(){return confirm("Удалить файл?")&&(e.row.deleteLink.isInnerElement=!0,this.file_input.value=""),!1}));else if(!e.cancelled)if(400===i)e.row.innerHTML='<div class="file_error">'+n+"</div>";else{var o="Ошибка при загрузке файла"+(n?": "+n:"");e.row.innerHTML='<div class="file_error">'+o+"</div>"}},e.progressCallback=function(t){e.row.progressBar.style.width=Math.round(t)+"%"},this.autostartOn&&e.upload()},Attachments.prototype.createRowFromUploadItem=function(t){var e=this;t.row=FN.ce("li"),t.row.innerHTML='<div class="attachments_file downloading"><div class="file_info"><span class="file_size">'+FN.toFixed(t.file.size/1024/1e3,2)+' Мб</span><span class="divide">|</span><a class="file_cancel">отменить</a></div><div class="file_name">'+(t.replaceName||t.file.name)+'</div><div class="progress"><div class="progress_bar" style="width: 0%; "></div></div></div>',t.row.progressBar=FN.geByClass1("progress_bar",t.row,"div"),t.row.cancelLink=FN.geByClass1("file_cancel",t.row,"a"),addEvent(t.row.cancelLink,"click",(function(){confirm("Прервать загрузку файла?")&&setTimeout((function(){t.completed||(FN.re(t.row),e.file_input.value="",t.cancel())}),5)})),this.list_container.appendChild(t.row)},Attachments.supportInfo=function(){$.support.fileSelecting?(FN.log("Attachments: [+] Your browser supports multiple file selecting"+($.support.fileSending?" and sending":"")),$.support.fileReading||FN.log("Attachments: [-] Your browser doesn't support file reading on client side"),$.support.uploadControl||FN.log("Attachments: [-] Your browser can't retrieve upload progress information (progress bars will be disabled)"),$.support.fileSending||FN.log("Attachments: [-] Your browser doesn't support FormData object (files will be send by default form submitting)"),FN.log("Attachments: [>] Now select some files to see what happen ...")):FN.log("Attachments: [-] Your browser doesn't support File API (uploads may be performed only by default form submitting)")};var SplittedTablesController=function(t){if(t=FN.extend({menu_id:"",container_id:"",containers_class_name:"",normal_view_link_id:"",full_screen_link_id:"",full_screen_container_id:""},t),this.loaded_quarters=[],this.container=FN.ge(t.container_id),this.container)if(this.menu=FN.ge(t.menu_id),this.menu){if(this.menu_current_link=FN.geByClass1("current",this.menu,"a"),this.menu_links=FN.geByClass("past",this.menu,"a").concat(this.menu_current_link||[]),!this.menu_links||!this.menu_links.length)return FN.log("SplittedTablesController: не заданы a-элементы меню"),void(this.container.innerHTML='<div class="sbp clr-red">Четверти не заполнены или еще не началась ни одна четверть</div>');this.quarters_mark_links=FN.geByClass("quarters",this.menu,"a"),this.normal_view_link=FN.ge(t.normal_view_link_id),this.full_screen_link=FN.ge(t.full_screen_link_id),this.full_screen_container=FN.ge(t.full_screen_container_id),this.containers_class_name=t.containers_class_name,this.quarters_container_class_name=t.quarters_container_class_name,this.qAttachEvents()}else FN.log("SplittedTablesController: не задано меню");else FN.log("SplittedTablesController: не задан контейнер")};SplittedTablesController.prototype.firstLoad=function(){var t=LOC.hash.includes("quarters-")?FN.geByAttr1("href","#"+LOC.hash,"a",this.menu):null;if(t&&this.loadQ)this.loadQ(t);else{var e=FN.geByAttr1("href","#"+LOC.hash,"a",this.menu);if(e)this.load(e);else{var n=this.menu_current_link||this.menu_links.slice(-1)[0];this.load(n)}}},SplittedTablesController.prototype.load=function(t){if(t){var e=this.containers_class_name,n=t.getAttribute("quarter_id"),i=t.getAttribute("src")||"";if(FN.each(this.menu_links,(function(t,e){FN.removeClass(e.parentNode,"active")})),FN.each(this.quarters_mark_links,(function(t,e){FN.removeClass(e.parentNode,"active")})),FN.addClass(t.parentNode,"active"),this.hideAllContainers(),FN.inArray(n,this.loaded_quarters)||FN.ge(e+"_"+n))FN.show(FN.ge(e+"_"+n));else{this.loaded_quarters.length||(this.container.innerHTML=""),this.loaded_quarters.push(n);var o=FN.ce("div",{id:e+"_"+n,className:e});this.container.appendChild(o),this._load(i,o)}}},SplittedTablesController.prototype.hideAllContainers=function(){FN.each(FN.geByClass(this.containers_class_name,this.container,"div"),(function(t,e){FN.hide(e)})),FN.each(FN.geByClass(this.quarters_container_class_name,this.container,"div"),(function(t,e){FN.hide(e)}))},SplittedTablesController.prototype._load=function(t,e){e.innerHTML=loader,$.ajax({type:"get",dataType:"html",url:t,success:function(t){$(e).html(t)}})},SplittedTablesController.prototype.qAttachEvents=function(){var t=this;isMobile||FN.each(this.menu_links,(function(e,n){addEvent(n,"click",(function(){FN.hasClass(n.parentNode,"active")||t.load(n)}))})),this.normal_view_link&&this.full_screen_link&&this.full_screen_container?(addEvent(this.full_screen_link,"click",(function(){FN.addClass(bodyNode,"j_fullscreen_view")})),addEvent(this.normal_view_link,"click",(function(){FN.removeClass(bodyNode,"j_fullscreen_view")}))):FN.hide(this.full_screen_link,this.normal_view_link),this.qAttachEvents=function(){}};var JournalsController=function(t,e){t=FN.extend({menu_id:"",container_id:"",containers_class_name:"",quarters_container_class_name:"",normal_view_link_id:"",full_screen_link_id:"",full_screen_container_id:"",menu_toggle_link_id:"",menu_toggle_block_id:"",lesson_start_time:0,lesson_end_time:0},t),SplittedTablesController.call(this,t),this.subjectID=e,this.quarters_container_class_name=t.quarters_container_class_name,this.menu_toggle_link=FN.ge(t.menu_toggle_link_id),this.menu_toggle_block=FN.ge(t.menu_toggle_block_id),this.lesson_start_time=t.lesson_start_time,this.lesson_end_time=t.lesson_end_time,isMobile&&this.lesson_start_time&&this.lesson_start_time&&(this.timer={box:FN.ge("journal_timer"),now:(new Date).getTime(),startTime:this.lesson_start_time,endTime:this.lesson_start_time},Math.abs(this.timer.now-this.lesson_start_time)<TIME.day&&Math.abs(this.timer.now-this.lesson_start_time)<TIME.day&&this.setTimer()),JournalPopups.initAll(),this.attachEvents(),isMobile||this.firstLoad(),FN.geByClass("active",this.menu_toggle_block).length&&FN.addClass(this.menu_toggle_block,"open")};inherits(JournalsController,SplittedTablesController),JournalsController.prototype.loadQ=function(t){var e=t.getAttribute("quarters_year"),n=this.quarters_container_class_name;if(FN.each(this.menu_links,(function(t,e){FN.removeClass(e.parentNode,"active")})),FN.each(this.quarters_mark_links,(function(t,e){FN.removeClass(e.parentNode,"active")})),t&&FN.addClass(t.parentNode,"active"),this.hideAllContainers(),FN.inArray(e,this.loaded_quarters)||FN.ge(n+"_"+e))FN.show(FN.ge(n+"_"+e));else{this.loaded_quarters.length||(this.container.innerHTML=""),this.loaded_quarters.push(e);var i=FN.ce("div",{id:n+"_"+e,className:n});this.container.appendChild(i),$.ajax({type:"get",dataType:"html",url:t?t.getAttribute("src"):"",beforeSend:function(t,e){SETTINGS.ajaxParams.beforeSend(t,e),i.innerHTML=loader},success:function(t){$(i).html(t)},error:function(t,e){SETTINGS.ajaxParams.error(t,e),i.innerHTML='<div class="sbp clr-red">Ошибка при загрузке</div>'},complete:function(t){FN.hide(loader)}})}},JournalsController.prototype.setTimer=function(){var t=this;this.updateTimer(),this.timer.setInterval=setInterval((function(){t.updateTimer()}),1e3)},JournalsController.prototype.updateTimer=function(){var t=(new Date).getTime(),e=this.timer.startTime,n=this.timer.endTime,i=this.timer.box;e-t>999?i.innerHTML="До начала урока <b>"+this.getTime(e-t)+"</b>":n-t>0?i.innerHTML="До конца урока <b>"+this.getTime(n-t)+"</b>":(i.innerHTML="Урок закончился",clearInterval(this.timer.setInterval))},JournalsController.prototype.getTime=function(t){var e,n,i,o=new Date;return o.setTime(t),t>0?(e=o.getUTCHours(),n=o.getUTCMinutes(),i=o.getUTCSeconds(),e<1&&n<1?i+" с.":(n=i>0?n+=1:n,e<1?n+" м.":e+" ч. "+(n?n+" м.":""))):0},JournalsController.prototype.attachEvents=function(){var t=this;isMobile||FN.each(this.quarters_mark_links,(function(e,n){addEvent(n,"click",(function(e){FN.hasClass(this.parentNode,"active")||t.loadQ(n)}))})),addEvent(this.menu_toggle_link,"click",(function(){FN.toggleClass(t.menu_toggle_block,"open")})),addEvent(document,"click",(function(t){var e=t.target||t.srcElement,n=!1;CURRENT.journal&&e!==window.overlay&&!FN.isAncestor(e,CURRENT.journal.table)||(n=!0),e.isInnerElement&&(n=!0),JournalPopups.isInside(e)&&(n=!0),n||(JournalPopups.hideAll(),CURRENT.journal.toggleActiveMarkTd())})),addEvent(document,"keydown.journal",(function(t){var e=t.keyCode;if(CURRENT.journal&&(e===KEY.ENTER&&CURRENT.journalPop,CURRENT.journalMarkTd)){if(e===KEY.LEFT){var n=AbstractJournal.prototype.getPrevTd();return $(n).click(),!1}if(e===KEY.RIGHT){n=AbstractJournal.prototype.getNextTd();return $(n).click(),!1}if(e===KEY.UP){n=AbstractJournal.prototype.getPrevTd2();return $(n).click(),!1}if(e===KEY.DOWN){n=AbstractJournal.prototype.getNextTd2();return $(n).click(),!1}if(e===KEY.ENTER)return CURRENT.journalPop?CURRENT.journalPop.noteIsFocused||$(CURRENT.journalPop.buttonOK).click():$(CURRENT.journalMarkTd).click(),t.preventDefault(),t.stopPropagation(),!1;if(CURRENT.journalPop&&!CURRENT.journalPop.noteIsFocused){if(e===KEY.ESC)return CURRENT.journalPop.hide(),!1;if(e>=KEY.NUM0&&e<=KEY.NUM9){0===(o=e-KEY.NUM0)&&(o=10);var i=FN.geByAttr("data-mark",o+"","a",CURRENT.journalPop.box);$(i).click()}else{if(e>=KEY.NUM0_&&e<=KEY.NUM9_){var o;0===(o=e-KEY.NUM0_)&&(o=10);i=FN.geByAttr("data-mark",o+"","a",CURRENT.journalPop.box);return $(i).click(),!1}if(e===KEY.Y){i=FN.geByAttr("data-mark","-1","a",CURRENT.journalPop.box);return $(i).click(),!1}if(e===KEY.BACKSPACE){i=FN.geByAttr("data-mark","","a",CURRENT.journalPop.box);return $(i).click(),!1}if(e===KEY.D){i=CURRENT.journalPop.typeLink;return $(i).click(),!1}if(e===KEY.R){i=CURRENT.journalPop.noteLink;return $(i).click(),!1}}}}}))};var ProgressController=function(t){t=FN.extend({menu_id:"",container_id:"",containers_class_name:"",normal_view_link_id:"",full_screen_link_id:"",full_screen_container_id:""},t),SplittedTablesController.call(this,t),isMobile||this.firstLoad()};inherits(ProgressController,SplittedTablesController);var ProgressClubsController=function(t){t=FN.extend({menu_id:"",container_id:"",containers_class_name:"",normal_view_link_id:"",full_screen_link_id:"",full_screen_container_id:""},t),SplittedTablesController.call(this,t),isMobile||this.firstLoad()};inherits(ProgressClubsController,SplittedTablesController);var SplittedTable=function(t,e){e=FN.extend({table_id:"",left_table_id:"",scroll:{box_id:"",link_left_id:"",link_right_id:""},marks_class_name:""},e),this.table=FN.ge(e.table_id),this.table?(this.left_table=FN.ge(e.left_table_id),this.left_table?(this.table.thead=FN.geByTag1("thead",this.table),this.table.tbody=FN.geByTag1("tbody",this.table),this.table.tbody.trs=FN.geByTag("tr",this.table.tbody),this.table.tfoot=FN.geByTag1("tfoot",this.table),this.left_table.thead=FN.geByTag1("thead",this.left_table),this.left_table.tbody=FN.geByTag1("tbody",this.left_table),this.left_table.tbody.trs=FN.geByTag("tr",this.left_table.tbody),this.class_names={mark:e.marks_class_name},e.scroll?(this.scroll={box:FN.ge(e.scroll.box_id),left_link:FN.ge(e.scroll.link_left_id),right_link:FN.ge(e.scroll.link_right_id),interval:0},this.scroll.box&&this.scroll.left_link&&this.scroll.right_link||(this.scroll=!1)):this.scroll=!1,"JTable"===t?(this.table.thead.tr_lesson_dates=FN.geByClass1("lesson_dates",this.table.thead,"tr"),this.table.thead.tds_lesson_date=FN.geByClass("lesson_date",this.table.thead.tr_lesson_dates,"td"),this.table.tfoot&&(this.table.tfoot.tr_lesson_dates=FN.geByClass1("lesson_dates",this.table.tfoot,"tr"),this.table.tfoot.tds_lesson_date=FN.geByClass("lesson_date",this.table.tfoot.tr_lesson_dates,"td")),SplittedTable.prototype.sAttachEvents.apply(this),this.addBoundary(),this.sProcessTable()):"QTable"===t&&SplittedTable.prototype.qProcessTable.apply(this),this.paintEvenTrs(),this.sqAttachEvents()):FN.log("SplittedTable: не задана левая таблица")):FN.log("SplittedTable: не задана основная таблица")};SplittedTable.prototype.paintEvenTrs=function(){FN.each([this.table,this.left_table],(function(t,e){TABLE.doEvenRows(e)}))},SplittedTable.prototype.processTrsMarks=function(){var t=this;FN.each(this.table.tbody.trs,(function(e,n){t.processTrMarks(n)}))},SplittedTable.prototype.processTrMarks=function(t){var e=FN.geByClass(this.class_names.mark,t,"td"),n=this.getMarksInfo(e);t.avgTd&&(t.avgTd.innerHTML=null!==n.avg?n.avg:"&mdash;"),t.avgSpan&&(t.avgSpan.innerHTML=null!==n.avg?n.avg:"&mdash;"),t.countSpan&&(t.countSpan.innerHTML=n.count),t.skipsTd&&(t.skipsTd.innerHTML=n.skips),t.highestSpan&&(t.highestSpan.innerHTML=null!==n.highest?n.highest:"&mdash;"),t.prevailingSpan&&(t.prevailingSpan.innerHTML=null!==n.prevailing?n.prevailing:"&mdash;")},SplittedTable.prototype.processTd=function(t){},SplittedTable.prototype.getMarksInfo=function(t){var e=[],n=[];return FN.each(t,(function(t,i){var o=FN.trim(FN.stripHTML(i.innerHTML));if(o){var s=MARKS_HELPER.reconvertMark(o);FN.hasClass(i,"theme_control")?n.push(s):e.push(s)}})),e=MARKS_HELPER.flattenMarks(e),n=MARKS_HELPER.flattenMarks(n),MARKS_HELPER.getMarksInfo(e,n)},SplittedTable.prototype.addBoundary=function(){var t=this.table.thead.tds_lesson_date,e=this.table.tfoot?this.table.tfoot.tds_lesson_date:null,n=this.table.thead.tdsTheme,i=this.table.tdsHometask;if(t&&t.length){var o=-1,s=0,a=-1,r={},l={},c=[];if(r.td=t[0],r.num=r.td.getAttribute("week"),FN.each(FN.geByClass("boundary",this.table,"td"),(function(t,e){FN.removeClass(e,"boundary")})),FN.each(FN.geByClass("week_boundary",this.table,"td"),(function(t,e){FN.removeClass(e,"week_boundary")})),i&&FN.each(i,(function(t,e){FN.removeClass(e,"boundary"),FN.removeClass(e,"week_boundary")})),n&&FN.each(n,(function(t,e){FN.removeClass(e,"boundary"),FN.removeClass(e,"week_boundary")})),FN.each(t,(function(t,e){FN.hasClass(e,"past")&&(o+=1,FN.hasClass(e,"hidden")||(s+=1,a=o)),l.td=FN.domNS(e),l.td&&(l.num=l.td.getAttribute("week"),FN.hasClass(r.td,"hidden")?(r.td=l.td,r.num=l.num):FN.hasClass(l.td,"hidden")||(r.num!==l.num&&(c.push(r.td.getAttribute("h")),FN.addClass(r.td,"week_boundary")),r.td=l.td,r.num=l.num))})),FN.each(this.table.tbody.trs,(function(t,o){var s=FN.geByTag("td",o);FN.addClass(s[a],"boundary"),FN.each(c,(function(t,o){FN.addClass(s[o],"week_boundary"),e&&FN.addClass(e[o],"week_boundary"),i&&FN.addClass(i[o],"week_boundary"),n&&FN.addClass(n[o],"week_boundary")}))})),FN.addClass(t[a],"boundary"),e&&FN.addClass(e[a],"boundary"),i&&FN.addClass(i[a],"boundary"),n&&FN.addClass(n[a],"boundary"),this.scroll){var u,d=this.scroll.box,h=FN.getSize(d)[0],p=FN.getSize(t[0])[0]+1;u=o===t.length-1?s*p:s*p-h/1.25,d.scrollLeft=u}}},SplittedTable.prototype.scrolling=function(t){var e=this.scroll.box.scrollLeft;this.scroll.box.scrollLeft=e+t,this.scroll.box.scrollLeft===e&&clearInterval(this.scroll.interval)},SplittedTable.prototype.scrollLeft=function(){this.scrolling(-3)},SplittedTable.prototype.scrollRight=function(){this.scrolling(3)},SplittedTable.prototype.sqAttachEvents=function(){var t=this;FN.each(this.table.tbody.trs,(function(e,n){addEvent(n,"mouseover",(function(){FN.addClass(n,"hover"),FN.addClass(t.left_table.tbody.trs[e],"hover")})),addEvent(n,"mouseout",(function(){FN.removeClass(n,"hover"),FN.removeClass(t.left_table.tbody.trs[e],"hover")}))})),FN.each(this.left_table.tbody.trs,(function(e,n){addEvent(n,"mouseover",(function(){FN.addClass(n,"hover"),FN.addClass(t.table.tbody.trs[e],"hover")})),addEvent(n,"mouseout",(function(){FN.removeClass(n,"hover"),FN.removeClass(t.table.tbody.trs[e],"hover")})),addEvent(n,"click",(function(){FN.toggleClass(n,"selected"),FN.toggleClass(t.table.tbody.trs[e],"selected")}))})),this.scroll&&(addEvent(this.scroll.left_link,"mouseover",(function(){t.scroll.interval=setInterval((function(){t.scrollLeft()}),25)})),addEvent(this.scroll.right_link,"mouseover",(function(){t.scroll.interval=setInterval((function(){t.scrollRight()}),25)})),addEvent(this.scroll.left_link,"mouseout",(function(){clearInterval(t.scroll.interval)})),addEvent(this.scroll.right_link,"mouseout",(function(){clearInterval(t.scroll.interval)})),addEvent(this.scroll.left_link,"click",(function(){t.scroll.box.scrollLeft=0,clearInterval(t.scroll.interval)})),addEvent(this.scroll.right_link,"click",(function(){t.scroll.box.scrollLeft=FN.getSize(t.table)[0],clearInterval(t.scroll.interval)}))),this.sqAttachEvents=function(){}},SplittedTable.prototype.sAttachEvents=function(){this.sAttachEvents=function(){}},SplittedTable.prototype.qProcessTable=function(){var t=this;FN.each(this.table.tbody.trs,(function(e,n){n.tds=FN.geByTag("td",n),n.avgTd=FN.geByClass1("avg",n,"td"),FN.each(n.tds,(function(n,i){i.setAttribute("h",n),i.setAttribute("v",e),t.processTd(i)})),n.setAttribute("v",e)})),FN.each(this.left_table.tbody.trs,(function(t,e){e.setAttribute("v",t)}))},SplittedTable.prototype.sProcessTable=function(){var t=this,e=this.table.thead.tds_lesson_date;FN.each(e,(function(t,e){e.setAttribute("h",t),e.date=e.getAttribute("date")})),FN.each(this.table.tbody.trs,(function(n,i){i.tds=FN.geByTag("td",i),i.avgTd=FN.geByClass1("avg",i,"td"),i.skipsTd=FN.geByClass1("skips",i,"td"),i.avgSpan=FN.geByClass1("avg",t.left_table.tbody.trs[n],"span"),i.countSpan=FN.geByClass1("count",t.left_table.tbody.trs[n],"span"),i.highestSpan=FN.geByClass1("highest",t.left_table.tbody.trs[n],"span"),i.prevailingSpan=FN.geByClass1("prevailing",t.left_table.tbody.trs[n],"span"),FN.each(i.tds,(function(i,o){o.setAttribute("h",i),o.setAttribute("v",n),e[i]&&o.setAttribute("title",e[i].date),t.processTd(o)})),i.setAttribute("v",n)})),FN.each(this.left_table.tbody.trs,(function(t,e){e.setAttribute("v",t)}))};var AbstractProgress=function(t,e){e=FN.extend({table_id:"",left_table_id:"",scroll:{box_id:"",link_left_id:"",link_right_id:""},marks_class_name:""},e),SplittedTable.call(this,t,e),this.gAttachEvents()};inherits(AbstractProgress,SplittedTable),AbstractProgress.prototype.gAttachEvents=function(){this.gAttachEvents=function(){}};var StandardProgress=function(t){t=FN.extend({table_id:"",left_table_id:"",scroll:{box_id:"",link_left_id:"",link_right_id:""},marks_class_name:""},t),AbstractProgress.call(this,"JTable",t),this.loaded_marks_info=[],this.table.tbody.marks_info_tds=FN.geByAttr("marks-ids",null,"td",this.table.tbody),this.processTrsMarks(),this.addBoundary(),this.attachEvents()};inherits(StandardProgress,AbstractProgress),StandardProgress.prototype.showMarkInfo=function(t){var e=this,n=t.getAttribute("marks-ids").split(",");if(n&&n.length)if(FN.inArray(n[0],this.loaded_marks_info)){var i=FN.ge("jpop_mark_info_"+n[0]);this.setPopPosition(i,t),FN.show(i)}else{this.loaded_marks_info.push(n[0]);i=FN.ce("div",{className:"jpop_mark_info",id:"jpop_mark_info_"+n[0],innerHTML:loader});bodyNode.appendChild(i),this.setPopPosition(i,t);var o="";$.ajax({type:"get",url:"/marks/"+n+"/info",success:function(n){FN.each(n,(function(t,e){o+="<ul>",e.lesson_note_type&&(o+="<li><b>"+e.lesson_note_type+"</b></li>"),e.lesson_note_text&&(o+="<li><small>"+e.lesson_note_text+"</small></li>"),o+="<li>Отметка: <b>"+e.m+"</b></li>",e.note&&(o+="<li>Комментарий: <b>"+e.note+"</b></li>"),o+="<li>Поставил(а): "+e.user+"</li>",e.created&&(o+="<li><small>Дата: "+e.created+"</small></li>"),e.updated&&(o+="<li><small>Обновлена: "+e.updated+"</small></li>"),e.lesson_without_date&&(o+="<li>(урок без даты)</li>"),o+="</ul>"})),i.innerHTML=o,e.setPopPosition(i,t)},error:function(n,o){SETTINGS.ajaxParams.error(n,o),i.innerHTML='<ul><li class="clr-red">Ошибка при загрузке</li></ul>',e.setPopPosition(i,t)}}),addEvent(i,"mouseover",(function(){FN.show(this)})),addEvent(i,"mouseout",(function(){FN.hide(this)}))}},StandardProgress.prototype.hideAllMarkInfoPopups=function(){var t=FN.geByClass("jpop_mark_info",bodyNode,"div");FN.each(t,(function(t,e){FN.hide(e)}))},StandardProgress.prototype.setPopPosition=function(t,e){FN.setStyle(t,{left:0,top:0});var n=FN.getXY(e),i=FN.getSize(e),o=FN.getSize(t),s=n[0],a=n[1];BROWSER.msie7&&(s-=188),lastWindowWidth-n[0]<o[0]+50&&(s=s-o[0]+i[0]),a+=i[1],FN.setStyle(t,{left:s,top:a})},StandardProgress.prototype.attachEvents=function(){var t=this;FN.each(this.table.tbody.marks_info_tds,(function(e,n){n.removeAttribute("title"),addEvent(n,"mouseover",(function(){t.showMarkInfo(n)})),addEvent(n,"mouseout",(function(){t.hideAllMarkInfoPopups()}))})),this.attachEvents=function(){}};var QuartersProgress=function(t,e){t=FN.extend({table_id:"",left_table_id:"",scroll:{box_id:"",link_left_id:"",link_right_id:""},marks_class_name:""},t),AbstractProgress.call(this,"QTable",t,e),this.processTrsMarks(),this.attachEvents()};inherits(QuartersProgress,AbstractProgress),QuartersProgress.prototype.attachEvents=function(){this.attachEvents=function(){}},CURRENT=CURRENT||{},CURRENT.journal=null,CURRENT.journalPop=null,CURRENT.journalMarkTd=null;var JournalPopups={list:["standard_mark","quarter_mark","examination_mark","year_mark","total_mark","limited_mark","hometask","lesson_note","limited_lesson_note","theme","help"],hideAll:function(){var t=null;FN.each(this.list,(function(e,n){(t=JournalPopup[n])&&t.hide&&t.hide()}))},isInside:function(t){var e=null,n=!1;return FN.each(this.list,(function(i,o){(e=JournalPopup[o])&&(t===e.box||FN.isAncestor(t,e.box))&&(n=!0)})),n},initAll:function(){var t=null;FN.each(this.list,(function(e,n){(t=JournalPopup[n])&&t.init&&t.init(),t&&t.attachEvents&&t.attachEvents()}))}},JournalPopup={show:function(){this.box.style.display="block",CURRENT.journalPop=this},hide:function(){window.overlay&&(window.overlay.style.display="none"),this.box&&(this.box.style.display="none"),CURRENT.journalPop=null}};JournalPopup.standard_mark={init:function(){this.box=FN.ge("jpop_mark"),this.pupil=FN.ge("jpop_mark_pupil"),this.date=FN.ge("jpop_mark_date"),this.links=this.box?FN.geByAttr("data-mark",null,"a",this.box):[],this.vis=FN.ge("jpop_mark_vis"),this.buttonOK=FN.ge("jpop_mark_button_ok"),this.buttonCancel=FN.ge("jpop_mark_button_cancel"),this.noteLink=FN.ge("jpop_mark_note_link"),this.noteBox=FN.ge("jpop_mark_note"),this.noteTextarea=FN.ge("jpop_mark_note_text"),this.noteIsFocused=!1,this.typeLink=FN.ge("jpop_mark_type_link"),this.typeSpan=FN.geByTag1("span",this.typeLink)},attachEvents:function(){var t=this;addEvent(this.noteLink,"click",(function(){FN.toggle(t.noteBox),isMobile||t.noteTextarea.focus()})),addEvent(this.typeLink,"click",(function(){CURRENT.journal&&CURRENT.journal.toggleMarkType()})),FN.each(this.links,(function(t,e){addEvent(e,"click",(function(){CURRENT.journal&&CURRENT.journal.changeCurMark(e)}))})),addEvent(this.buttonOK,"click",(function(){CURRENT.journal&&CURRENT.journal.saveMark()})),addEvent(this.buttonCancel,"click",(function(){t.hide()})),addEvent(this.noteTextarea,"focus",(function(){t.noteIsFocused=!0})),addEvent(this.noteTextarea,"blur",(function(){t.noteIsFocused=!1})),this.attachEvents=function(){}},show:function(){JournalPopup.show.call(this)},hide:function(){JournalPopup.hide.call(this)}},JournalPopup.quarter_mark={init:function(){this.box=FN.ge("jpop_qmark"),this.pupil=FN.ge("jpop_qmark_pupil"),this.links=this.box?FN.geByAttr("data-mark",null,"a",this.box):[],this.buttonCancel=FN.ge("jpop_qmark_button_cancel")},attachEvents:function(){var t=this;addEvent(this.buttonCancel,"click",(function(){t.hide()})),FN.each(this.links,(function(t,e){addEvent(e,"click",(function(){CURRENT.journal&&CURRENT.journal.changeCurQMark(e)}))})),this.attachEvents=function(){}},show:function(){JournalPopup.show.call(this)},hide:function(){JournalPopup.hide.call(this)}},JournalPopup.examination_mark={init:function(){this.box=FN.ge("jpop_emark"),this.pupil=FN.ge("jpop_emark_pupil"),this.links=this.box?FN.geByAttr("data-mark",null,"a",this.box):[],this.vis=FN.ge("jpop_emark_vis"),this.buttonOK=FN.ge("jpop_emark_button_ok"),this.buttonCancel=FN.ge("jpop_emark_button_cancel"),this.typeLink=FN.ge("jpop_emark_type_link"),this.typeSpan=FN.geByTag1("span",this.typeLink)},attachEvents:function(){var t=this;addEvent(this.typeLink,"click",(function(){CURRENT.journal&&CURRENT.journal.toggleEMarkType()})),addEvent(this.buttonOK,"click",(function(){CURRENT.journal&&CURRENT.journal.saveEMark()})),addEvent(this.buttonCancel,"click",(function(){t.hide()})),FN.each(this.links,(function(t,e){addEvent(e,"click",(function(){CURRENT.journal&&CURRENT.journal.changeCurEMark(e)}))})),this.attachEvents=function(){}},show:function(){JournalPopup.show.call(this)},hide:function(){JournalPopup.hide.call(this)}},JournalPopup.year_mark={init:function(){this.box=FN.ge("jpop_ymark"),this.pupil=FN.ge("jpop_ymark_pupil"),this.links=this.box?FN.geByAttr("data-mark",null,"a",this.box):[],this.buttonCancel=FN.ge("jpop_ymark_button_cancel")},attachEvents:function(){var t=this;addEvent(this.buttonCancel,"click",(function(){t.hide()})),FN.each(this.links,(function(t,e){addEvent(e,"click",(function(){CURRENT.journal&&CURRENT.journal.changeCurYMark(e)}))})),this.attachEvents=function(){}},show:function(){JournalPopup.show.call(this)},hide:function(){JournalPopup.hide.call(this)}},JournalPopup.total_mark={init:function(){this.box=FN.ge("jpop_tmark"),this.pupil=FN.ge("jpop_tmark_pupil"),this.links=this.box?FN.geByAttr("data-mark",null,"a",this.box):[],this.buttonCancel=FN.ge("jpop_tmark_button_cancel")},attachEvents:function(){var t=this;addEvent(this.buttonCancel,"click",(function(){t.hide()})),FN.each(this.links,(function(t,e){addEvent(e,"click",(function(){CURRENT.journal&&CURRENT.journal.changeCurTMark(e)}))})),this.attachEvents=function(){}},show:function(){JournalPopup.show.call(this)},hide:function(){JournalPopup.hide.call(this)}},JournalPopup.limited_mark={init:function(){this.box=FN.ge("jpop_limited_mark"),this.date=FN.ge("jpop_limited_mark_date"),this.close=FN.ge("jpop_limited_mark_close")},attachEvents:function(){var t=this;addEvent(this.close,"click",(function(){t.hide()}))},show:function(){JournalPopup.show.call(this)},hide:function(){JournalPopup.hide.call(this)}},JournalPopup.hometask={init:function(){this.box=FN.ge("jpop_hometask"),this.form=FN.ge("jpop_hometask_form"),this.date=FN.ge("jpop_hometask_date"),this.textarea=FN.ge("jpop_hometask_text"),this.attachments_container=FN.ge("jpop_hometask_saved_attachments"),this.attachments_list=FN.ge("attachments_list_1"),this.saved_attachments_list=FN.ge("saved_attachments_list"),this.attachments_input=FN.geByAttr1("name","attachments","input",this.box),this.buttonOK=FN.ge("jpop_hometask_button"),this.cancel=FN.ge("jpop_hometask_cancel"),isMobile||(this.toolbar=FN.ge("jpop_hometask_toolbar"))},attachEvents:function(){var t=this;isMobile||FN.each(FN.geByTag("a",t.toolbar),(function(e,n){addEvent(n,"click",(function(){var e=n.innerHTML;FN.insertAtCaret(t.textarea,e)}))})),addEvent(this.buttonOK,"click",(function(){CURRENT.journal&&CURRENT.journal.saveHometask()})),addEvent(this.cancel,"click",(function(){t.hide()})),this.attachEvents=function(){}},show:function(){var t=this;JournalPopup.show.call(this);var e=this.attachments_container.getAttribute("fetch_from"),n=CURRENT.journal.cur.hometask.td.getAttribute("attribute_id");e&&n&&$.ajax({url:e,data:{item_id:n,can_delete:1},type:"get",dataType:"text",success:function(e){t.attachments_container.innerHTML=e}})},hide:function(){JournalPopup.hide.call(this)}},JournalPopup.lesson_note={init:function(){this.box=FN.ge("jpop_lesson_note"),this.date=FN.ge("jpop_lesson_note_date"),this.subtypes=FN.geByAttr("name","lesson-note","input",this.box),this.textarea=FN.ge("jpop_lesson_note_text"),this.buttonOK=FN.ge("jpop_lesson_note_button"),this.cancel=FN.ge("jpop_lesson_note_cancel")},attachEvents:function(){var t=this;addEvent(this.buttonOK,"click",(function(){CURRENT.journal&&CURRENT.journal.saveLessonNote()})),addEvent(this.cancel,"click",(function(){t.hide()})),this.attachEvents=function(){}},show:function(){JournalPopup.show.call(this)},hide:function(){JournalPopup.hide.call(this)}},JournalPopup.limited_lesson_note={init:function(){this.box=FN.ge("jpop_limited_lesson_note"),this.date=FN.ge("jpop_limited_lesson_note_date"),this.subtypes=FN.geByAttr("data-subtype",null,"li",this.box),this.text=FN.ge("jpop_limited_lesson_note_text"),this.close=FN.ge("jpop_limited_lesson_note_close")},attachEvents:function(){var t=this;addEvent(this.close,"click",(function(){t.hide()})),this.attachEvents=function(){}},show:function(){JournalPopup.show.call(this)},hide:function(){JournalPopup.hide.call(this)}},JournalPopup.theme={init:function(){this.box=FN.ge("jpop_theme"),this.date=FN.ge("jpop_theme_date"),this.textarea=FN.ge("jpop_theme_text"),this.buttonOK=FN.ge("jpop_theme_button"),this.cancel=FN.ge("jpop_theme_cancel")},attachEvents:function(){var t=this;addEvent(this.buttonOK,"click",(function(){CURRENT.journal&&CURRENT.journal.saveTheme()})),addEvent(this.cancel,"click",(function(){t.hide()})),this.attachEvents=function(){}},show:function(){JournalPopup.show.call(this)},hide:function(){JournalPopup.hide.call(this)}},JournalPopup.help={init:function(){this.link=FN.ge("journal_help_link")},attachEvents:function(){var t=this;isMobile&&addEvent(this.link,"click",(function(){t.loaded?(t.setPosition(),FN.show(window.overlay),FN.show(t.container)):(t.container=FN.ce("div",{id:"journal_help"}),bodyNode.appendChild(t.container),t.container.innerHTML=loader,t.setPosition(),$.ajax({type:"get",dataType:"html",url:$(t.link).attr("url"),beforeSend:function(e,n){SETTINGS.ajaxParams.beforeSend(e,n),FN.show(window.overlay),FN.show(t.container)},success:function(e){t.loaded=!0,$(t.container).html(e),addEvent(FN.ge("journal_help_cancel"),"click",(function(){FN.hide(window.overlay),FN.hide(t.container)})),t.setPosition()},error:function(e,n){SETTINGS.ajaxParams.error(e,n),FN.hide(window.overlay),FN.hide(t.container)},complete:function(t){FN.hide(loader)}}))})),this.attachEvents=function(){}},setPosition:function(){if(this.container){var t=FN.getSize(this.container),e=scrollGetY(),n=e+window.lastWindowHeight/2-t[1]/1.8;n<e+10&&(n=e+10),FN.setStyle(this.container,{top:n+"px",left:"50%",marginLeft:t[0]/-2})}},show:function(){JournalPopup.show.call(this)},hide:function(){JournalPopup.hide.call(this)}};var AbstractJournal=function(t,e,n,i,o){n=FN.extend({table:"",left_table:"",subgroups_menu_id:"",allow_changes:!0},n),SplittedTable.call(this,t,n),this.save_mark_url=e.save_mark,this.save_qmark_url=e.save_qmark,this.save_emark_url=e.save_emark,this.save_ymark_url=e.save_ymark,this.save_tmark_url=e.save_tmark,this.subjectID=parseInt(i,10),this.classID=parseInt(o,10),this.table.tbody.tdsMark=FN.geByClass("mark",this.table.tbody,"td"),this.table.tbody.tdsQMark=FN.geByClass("qmark",this.table.tbody,"td"),this.subgroups={},this.subgroups.menu=FN.ge(n.subgroups_menu_id),this.subgroups.links=FN.geByTag("a",this.subgroups.menu),this.cur={subgroupID:0,hometask:{},lessonnote:{},theme:{},mark:{},qmark:{},emark:{},ymark:{},tmark:{}},this.doHidePops=!0,n.allow_changes&&this.gAttachEvents(),this.gAttachAdditionalEvents()};inherits(AbstractJournal,SplittedTable),AbstractJournal.prototype.setSubgroupId=function(t){t=parseInt(t,10),this.cur.subgroupID=t},AbstractJournal.prototype.getSubgroupId=function(){return this.cur.subgroupID},AbstractJournal.prototype.toggleActiveMarkTd=function(t){CURRENT.journalMarkTd&&(FN.removeClass(CURRENT.journalMarkTd,"mark_active"),CURRENT.journalMarkTd=null),t&&(FN.addClass(t,"mark_active"),CURRENT.journalMarkTd=t)},AbstractJournal.prototype.checkMarkTd=function(t){return t&&FN.isVisible(t)&&(FN.hasClass(t,"mark")||FN.hasClass(t,"qmark")||FN.hasClass(t,"emark")||FN.hasClass(t,"ymark")||FN.hasClass(t,"tmark"))},AbstractJournal.prototype._getSomeTd=function(t){var e=CURRENT.journalMarkTd||{};do{if(e=t?FN.domEL(e.previousSibling,!0):FN.domEL(e.nextSibling),this.checkMarkTd(e))return e}while(e)},AbstractJournal.prototype.getPrevTd=function(){return this._getSomeTd(!0)},AbstractJournal.prototype.getNextTd=function(){return this._getSomeTd(!1)},AbstractJournal.prototype._getSomeTd2=function(t){var e=CURRENT.journalMarkTd||{},n=e.parentNode,i=e.getAttribute("h");do{if(n=t?FN.domVPS(n):FN.domVNS(n),e=FN.geByTag("td",n)[i],this.checkMarkTd(e))return e}while(n)},AbstractJournal.prototype.getPrevTd2=function(){return this._getSomeTd2(!0)},AbstractJournal.prototype.getNextTd2=function(){return this._getSomeTd2()},AbstractJournal.prototype.showPopMark=function(t){var e=JournalPopup.standard_mark,n=this.cur.mark,i=t.parentNode,o=t.getAttribute("h"),s=t.getAttribute("v"),a=this.table.thead.tds_lesson_date[o];FN.extend(n,{td:t,id:t.getAttribute("m_id")||"",mark:FN.stripHTML(t.innerHTML),note:t.getAttribute("note")||"",type:"single",lessonID:a.getAttribute("lesson_id"),lessonDay:a.getAttribute("day"),pupilID:i.getAttribute("pupil_id")}),"н/з"!==n.mark&&"н/а"!==n.mark&&n.mark.split("/").length>=2&&(n.type="double"),n.newMark=n.mark=MARKS_HELPER.reconvertMark(n.mark),n.newNote=n.note,CURRENT.journal=this,this.toggleActiveMarkTd(t),e.noteTextarea.value=n.note,""!==n.note?FN.show(e.noteBox):FN.hide(e.noteBox),this.toggleMarkType(n.type),isMobile&&(e.pupil.innerHTML=FN.geByTag1("td",this.left_table.tbody.trs[s]).innerHTML,"qmarks"!==this.type&&(e.date.innerHTML=this.table.thead.tds_lesson_date[o].getAttribute("date"))),JournalPopups.hideAll(),this.setPopPosition(e.box,t),e.show(),this.doHidePops=!1},AbstractJournal.prototype.showPopLimitedMark=function(t){var e=JournalPopup.limited_mark,n=t.getAttribute("h");CURRENT.journal=this,this.toggleActiveMarkTd(t),isMobile&&(e.date.innerHTML=this.table.thead.tds_lesson_date[n].getAttribute("date")),JournalPopups.hideAll(),this.setPopPosition(e.box,t),e.show(),this.doHidePops=!1},AbstractJournal.prototype.showPopQMark=function(t){var e=JournalPopup.quarter_mark,n=this.cur.qmark,i=t.parentNode,o=t.getAttribute("v");FN.extend(n,{td:t,id:t.getAttribute("m_id")||"",mark:FN.stripHTML(t.innerHTML),pupilID:i.getAttribute("pupil_id"),quarterID:t.getAttribute("quarter_id")}),n.newMark=n.mark=MARKS_HELPER.reconvertMark(n.mark),CURRENT.journal=this,this.toggleActiveMarkTd(t),"qmark"===this.class_names.mark||isMobile||(FN.domNS(i)?FN.removeClass(e.box,"last"):FN.addClass(e.box,"last")),isMobile&&(e.pupil.innerHTML=FN.geByTag1("td",this.left_table.tbody.trs[o]).innerHTML),JournalPopups.hideAll(),"qmark"===this.class_names.mark?this.setPopPosition(e.box,t,"bottom","center"):this.setPopPosition(e.box,t,"bottom","left"),e.show(),this.doHidePops=!1},AbstractJournal.prototype.showPopEMark=function(t){var e=JournalPopup.examination_mark,n=this.cur.emark,i=t.parentNode,o=t.getAttribute("v");FN.extend(n,{td:t,id:t.getAttribute("m_id")||"",mark:FN.stripHTML(t.innerHTML),type:"single",pupilID:i.getAttribute("pupil_id")}),n.mark.split("/").length>=2&&(n.type="double"),n.newMark=n.mark=MARKS_HELPER.reconvertMark(n.mark),CURRENT.journal=this,this.toggleActiveMarkTd(t),this.toggleEMarkType(n.type),isMobile&&(e.pupil.innerHTML=FN.geByTag1("td",this.left_table.tbody.trs[o]).innerHTML),JournalPopups.hideAll(),this.setPopPosition(e.box,t,"bottom","left"),e.show(),this.doHidePops=!1},AbstractJournal.prototype.showPopYMark=function(t){var e=JournalPopup.year_mark,n=this.cur.ymark,i=t.parentNode,o=t.getAttribute("v");FN.extend(n,{td:t,id:t.getAttribute("m_id")||"",mark:FN.stripHTML(t.innerHTML),pupilID:i.getAttribute("pupil_id")}),n.newMark=n.mark=MARKS_HELPER.reconvertMark(n.mark),CURRENT.journal=this,this.toggleActiveMarkTd(t),isMobile&&(e.pupil.innerHTML=FN.geByTag1("td",this.left_table.tbody.trs[o]).innerHTML),JournalPopups.hideAll(),this.setPopPosition(e.box,t,"bottom","left"),e.show(),this.doHidePops=!1},AbstractJournal.prototype.showPopTMark=function(t){var e=JournalPopup.total_mark,n=this.cur.tmark,i=t.parentNode,o=t.getAttribute("v");FN.extend(n,{td:t,id:t.getAttribute("m_id")||"",mark:FN.stripHTML(t.innerHTML),pupilID:i.getAttribute("pupil_id")}),n.newMark=n.mark=MARKS_HELPER.reconvertMark(n.mark),CURRENT.journal=this,this.toggleActiveMarkTd(t),isMobile&&(e.pupil.innerHTML=FN.geByTag1("td",this.left_table.tbody.trs[o]).innerHTML),JournalPopups.hideAll(),console.log("! ",e),this.setPopPosition(e.box,t,"bottom","left"),e.show(),this.doHidePops=!1},AbstractJournal.prototype.toggleMarkType=function(t){var e=JournalPopup.standard_mark,n=this.cur.mark;this._toggleMarkType(e,n,t)},AbstractJournal.prototype.toggleEMarkType=function(t){var e=JournalPopup.examination_mark,n=this.cur.emark;this._toggleMarkType(e,n,t)},AbstractJournal.prototype._toggleMarkType=function(t,e,n){"double"===(n=n||("single"===e.type?"double":"single"))?(e.newMark="н"===e.newMark||e.newMark<0?"/":e.newMark.indexOf("/")>-1?e.newMark:e.newMark+"/",t.vis.innerHTML=MARKS_HELPER.convertMark(e.newMark),t.typeSpan.innerHTML="m/m",e.type="double"):(e.newMark=e.newMark.split("/")[0],t.vis.innerHTML=MARKS_HELPER.convertMark(e.newMark),t.typeSpan.innerHTML="m",e.type="single")},AbstractJournal.prototype.updateTdMark=function(t){var e=t.td,n=e.parentNode;e.setAttribute("m_id",t.id),e.setAttribute("note",t.note),e.innerHTML=MARKS_HELPER.convertMark(t.mark)||"&nbsp;",FN.addClass(e,"mark_today"),this.processTd(e),this.processTrMarks(n)},AbstractJournal.prototype.updateTdQMark=function(){var t=this.cur.qmark,e=t.td;e.setAttribute("m_id",t.id),e.innerHTML=MARKS_HELPER.convertMark(t.mark)||"&nbsp;",FN.addClass(e,"mark_today"),this.processTd(e)},AbstractJournal.prototype.updateTdEMark=function(){var t=this.cur.emark,e=t.td;e.setAttribute("m_id",t.id),e.innerHTML=MARKS_HELPER.convertMark(t.mark)||"&nbsp;",FN.addClass(e,"mark_today"),this.processTd(e)},AbstractJournal.prototype.updateTdYMark=function(){var t=this.cur.ymark,e=t.td;e.setAttribute("m_id",t.id),e.innerHTML=MARKS_HELPER.convertMark(t.mark),FN.addClass(e,"mark_today"),this.processTd(e)},AbstractJournal.prototype.updateTdTMark=function(){var t=this.cur.tmark,e=t.td;e.setAttribute("m_id",t.id),e.innerHTML=MARKS_HELPER.convertMark(t.mark),FN.addClass(e,"mark_today"),this.processTd(e)},AbstractJournal.prototype.changeCurMark=function(t){var e=JournalPopup.standard_mark,n=this.cur.mark,i=t.getAttribute("data-mark");if(("н"===i||""===i||i<0)&&this.toggleMarkType("single"),"double"===n.type){var o=n.newMark.split("/");if(""===o[0]||""!==o[0]&&""!==o[1])return n.newMark=i+"/",void(e.vis.innerHTML=MARKS_HELPER.convertMark(n.newMark));n.newMark=o[0]+"/"+i}else n.newMark=i;e.vis.innerHTML=MARKS_HELPER.convertMark(n.newMark),this.saveMark()},AbstractJournal.prototype.changeCurQMark=function(t){var e=this.cur.qmark,n=t.getAttribute("data-mark");e.newMark=n,this.saveQMark()},AbstractJournal.prototype.changeCurEMark=function(t){var e=JournalPopup.examination_mark,n=this.cur.emark,i=t.getAttribute("data-mark");if(("н"===i||""===i||i<0)&&this.toggleEMarkType("single"),"double"===n.type){var o=n.newMark.split("/");if(""===o[0]||""!==o[0]&&""!==o[1])return n.newMark=i+"/",void(e.vis.innerHTML=MARKS_HELPER.convertMark(n.newMark));n.newMark=o[0]+"/"+i}else n.newMark=i;e.vis.innerHTML=MARKS_HELPER.convertMark(n.newMark),this.saveEMark()},AbstractJournal.prototype.changeCurYMark=function(t){var e=this.cur.ymark,n=t.getAttribute("data-mark");e.newMark=n,this.saveYMark()},AbstractJournal.prototype.changeCurTMark=function(t){var e=this.cur.tmark,n=t.getAttribute("data-mark");e.newMark=n,this.saveTMark()},AbstractJournal.prototype.saveMark=function(){var t,e=this,n=JournalPopup.standard_mark,i=this.cur.mark,o=i.newMark.split("/");i.newNote=FN.trim(n.noteTextarea.value),i.newMark=o[1]?i.newMark:o[0];var s=i.td,a=(i.id,i.newMark),r=i.newNote;i.mark!==i.newMark||i.note!==i.newNote?"..."!==s.innerHTML&&(t={id:i.id,m:i.newMark,note:i.newNote,lesson_id:i.lessonID,lesson_date:i.lessonDay,pupil_id:i.pupilID},s.innerHTML="...",n.hide(),"waiting"!==(s.getAttribute("m_id")||"")&&(s.setAttribute("m_id","waiting"),$.ajax({url:this.save_mark_url,data:t,complete:function(t){unlockButton(n.buttonOK)},success:function(t){e.updateTdMark({id:t.id,td:s,mark:a,note:r})},error:function(n,o){SETTINGS.ajaxParams.error(n,o),e.updateTdMark({id:t.id,td:s,mark:i.mark,note:i.note})}}))):n.hide()},AbstractJournal.prototype.saveQMark=function(){var t,e=this,n=JournalPopup.quarter_mark,i=this.cur.qmark;i.mark!==i.newMark?(t={id:i.id,m:i.newMark,quarter_id:i.quarterID,pupil_id:i.pupilID},lockButton(n.buttonOK),$.ajax({url:this.save_qmark_url,data:t,complete:function(t){unlockButton(n.buttonOK)},success:function(t){i.id=t.id,i.mark=i.newMark,e.updateTdQMark(),n.hide()}})):n.hide()},AbstractJournal.prototype.saveEMark=function(){var t,e=this,n=JournalPopup.examination_mark,i=this.cur.emark,o=i.newMark.split("/");i.newMark=o[1]?i.newMark:o[0],i.mark!==i.newMark?(t={id:i.id,m:i.newMark,pupil_id:i.pupilID,year:this.year},console.log("Данные для сохранения экз. отметки:"),console.dir(t),lockButton(n.buttonOK),$.ajax({url:this.save_emark_url,data:t,complete:function(t){unlockButton(n.buttonOK)},success:function(t){i.id=t.id,i.mark=i.newMark,e.updateTdEMark(),n.hide()}})):n.hide()},AbstractJournal.prototype.saveYMark=function(){var t,e=this,n=JournalPopup.year_mark,i=this.cur.ymark;i.mark!==i.newMark?(t={id:i.id,m:i.newMark,pupil_id:i.pupilID,year:this.year},console.log("Данные для сохранения годовой отметки:"),console.dir(t),lockButton(n.buttonOK),$.ajax({url:this.save_ymark_url,data:t,complete:function(t){unlockButton(n.buttonOK)},success:function(t){i.id=t.id,i.mark=i.newMark,e.updateTdYMark(),n.hide()}})):n.hide()},AbstractJournal.prototype.saveTMark=function(){var t,e=this,n=JournalPopup.total_mark,i=this.cur.tmark;i.mark!==i.newMark?(t={id:i.id,m:i.newMark,pupil_id:i.pupilID,year:this.year},console.log("Данные для сохранения итоговой отметки:"),console.dir(t),lockButton(n.buttonOK),$.ajax({url:this.save_tmark_url,data:t,complete:function(t){unlockButton(n.buttonOK)},success:function(t){i.id=t.id,i.mark=i.newMark,e.updateTdTMark(),n.hide()}})):n.hide()},AbstractJournal.prototype.setPopPosition=function(t,e,n,i){if(isMobile){s=FN.getSize(t);(c=scrollGetY()+window.lastWindowHeight/2-s[1]/1.8)<10&&(c=10),FN.show(window.overlay),FN.setStyle(t,{top:c+"px",left:"50%",marginLeft:s[0]/-2})}else{var o=FN.getXY(t.parentNode),s=FN.getSize(t),a=FN.getXY(e),r=FN.getSize(e),l=a[0]-o[0],c=a[1]-o[1],u=null;if(FN.removeClass(t,"left"),FN.removeClass(t,"center"),"left"===i)FN.addClass(t,"left"),l=l-s[0]+r[0];else FN.addClass(t,"center"),l=l-s[0]/2+r[0]/2-1;switch(BROWSER.msie7&&(l-=188),n){case"top":c=c-s[1]+3;break;case"top_by_bottom_position":u=-1*c;break;default:c=c+r[1]-3}u?FN.setStyle(t,{left:l,bottom:u}):FN.setStyle(t,{left:l,top:c})}},AbstractJournal.prototype.showSubgroupTable=function(t){var e=[this.table,this.left_table],n=(t.getAttribute("pupil_ids")||"").split(",");FN.each(this.subgroups.links,(function(t,e){FN.removeClass(e,"active")})),FN.addClass(t,"active"),this.setSubgroupId(t.getAttribute("subgroup_id"));var i=this.getSubgroupId();FN.each(e,(function(t,e){FN.each(e.tbody.trs,(function(t,e){FN.removeClass(e,"hidden")}))})),0!==i&&FN.each(e,(function(t,e){FN.each(e.tbody.trs,(function(t,e){var i=e.getAttribute("pupil_id");n.indexOf(i)>-1||FN.addClass(e,"hidden")}))})),this.paintEvenTrs(),JournalPopups.hideAll()},AbstractJournal.prototype.gAttachEvents=function(){var t=this;FN.each(this.table.tbody.tdsQMark,(function(e,n){addEvent(n,"click",(function(){t.showPopQMark(n)}))})),this.gAttachEvents=function(){}},AbstractJournal.prototype.gAttachAdditionalEvents=function(){var t=this;FN.each(this.subgroups.links,(function(e,n){addEvent(n,"click",(function(){FN.hasClass(n,"active")||t.showSubgroupTable(n)}))})),this.gAttachAdditionalEvents=function(){}};var StandardJournal=function(t,e,n,i){t=FN.extend({table_id:"",left_table_id:"",scroll:{box_id:"",link_left_id:"",link_right_id:""},lessons_count_id:"",subgroups_menu_id:"",mark_class_name:"",allow_changes:!0},t),AbstractJournal.call(this,"JTable",e,t,n,i),this.table.thead.trMonth=FN.geByClass1("months",this.table.thead,"tr"),this.table.thead.tdsMonth=FN.geByAttr("month",null,"td",this.table.thead.trMonth),this.table.tfoot.trMonth=FN.geByClass1("months",this.table.tfoot,"tr"),this.table.tfoot.tdsMonth=FN.geByAttr("month",null,"td",this.table.tfoot.trMonth),this.table.trHometasks=FN.geByClass1("hometasks",this.table,"tr"),this.table.tdsHometask=FN.geByClass("hometask",this.table.trHometasks,"td"),this.table.thead.trThemes=FN.geByClass1("themes",this.table.thead,"tr"),this.table.thead.tdsTheme=FN.geByClass("theme",this.table.thead.trThemes,"td"),this.lessons_count=FN.ge(t.lessons_count_id),this.calcMonthsColspans(),this.processTrHometasks(),this.processTrThemes(),this.processTrLessonDates(),this.processTrsMarks(),this.processLimitations(),this.addBoundary(),t.allow_changes&&this.attachEvents()};inherits(StandardJournal,AbstractJournal),StandardJournal.prototype.toggleActiveMarkTd=function(t){if(AbstractJournal.prototype.toggleActiveMarkTd.call(this,t),t&&!isMobile){var e=FN.getXY(t),n=FN.getSize(t),i=FN.getXY(this.scroll.box.parentNode),o=FN.getSize(this.scroll.box.parentNode);BROWSER.msie7&&(e[0]-=188);var s=e[0]-i[0],a=s+n[0]-o[0];s<0&&(this.doHidePops=!1,this.scrolling(s)),a+180>0&&(this.doHidePops=!1,this.scrolling(a+180))}},StandardJournal.prototype.processTd=function(t){SplittedTable.prototype.processTd.call(this,t),t.getAttribute("note")?FN.addClass(t,"noted_mark"):FN.removeClass(t,"noted_mark")},StandardJournal.prototype.calcMonthsColspans=function(){var t=this;FN.each(this.table.thead.tdsMonth,(function(e,n){var i=n.getAttribute("month"),o=FN.geByAttr("month",i,"td",t.table.thead.tr_lesson_dates),s=0,a=t.table.tfoot.tdsMonth[e];FN.each(o,(function(t,e){FN.hasClass(e,"hidden")||(s+=1)})),n.setAttribute("colSpan",s),a.setAttribute("colSpan",s);for(var r=isMobile?Math.ceil(s/5):Math.ceil(s/8),l='<p class="fl_l" style="width: '+100/(r=r>8?8:r<1?1:r)+'%">'+FN.geByTag1("p",n).innerHTML+"</p>",c="";r>0;r-=1)c+=l;n.innerHTML=c,a.innerHTML=c}))},StandardJournal.prototype.processTdHometask=function(t){var e=t.getAttribute("text")||"",n=t.getAttribute("exists");e||"1"==n||"true"==n?FN.addClass(t,"set"):FN.removeClass(t,"set")},StandardJournal.prototype.processTrHometasks=function(){var t=this;FN.each(this.table.tdsHometask,(function(e,n){t.processTdHometask(n)}))},StandardJournal.prototype.processTdTheme=function(t){var e=t.getAttribute("text")||"";t.setAttribute("title",e),e?FN.addClass(t,"set"):FN.removeClass(t,"set")},StandardJournal.prototype.processTrThemes=function(){var t=this;FN.each(this.table.thead.tdsTheme,(function(e,n){t.processTdTheme(n)}))},StandardJournal.prototype.processTdLessonDate=function(t){var e,n=t.getAttribute("text")||"",i=t.getAttribute("subtype")||"",o=FN.geByTag1("p",t),s=t.getAttribute("h");o.setAttribute("title",n),o.innerHTML=n,FN.removeClass(t,"lesson_control"),FN.removeClass(t,"theme_control"),FN.each(this.table.tbody.trs,(function(t,e){e.tds&&FN.removeClass(e.tds[s],"lesson_control"),e.tds&&FN.removeClass(e.tds[s],"theme_control")})),n&&"0"===i||"1"===i?e="lesson_control":"2"===i&&(e="theme_control"),e&&(FN.addClass(t,e),FN.each(this.table.tbody.trs,(function(t,n){n.tds&&FN.addClass(n.tds[s],e)})))},StandardJournal.prototype.processTrLessonDates=function(){var t=this;FN.each(this.table.thead.tds_lesson_date,(function(e,n){t.processTdLessonDate(n)}))},StandardJournal.prototype.processLimitations=function(){var t=this,e=this.table.thead.tds_lesson_date,n=this.table.tfoot&&this.table.tfoot.tds_lesson_date||[],i=[],o=[];e&&e.length&&(FN.each(e,(function(t,e){e.getAttribute("note-limitations")&&i.push(t),e.getAttribute("mark-limitations")&&o.push(t)})),FN.each(i,(function(t,e){n[e].setAttribute("note-limitations","true")})),FN.each(o,(function(e,i){FN.each(t.table.tbody.trs,(function(t,e){FN.geByTag("td",e)[i].setAttribute("mark-limitations","true")})),n[i].setAttribute("mark-limitations","true")})))},StandardJournal.prototype.showPopHometask=function(t){var e=JournalPopup.hometask,n=this.cur.hometask;FN.extend(n,{td:t,text:t.getAttribute("text")||"",file_exists:t.getAttribute("exists")||"0",attribute_id:t.getAttribute("attribute_id")||"",lesson_id:t.getAttribute("lesson_id")||""}),CURRENT.journal=this,this.toggleActiveMarkTd(),e.date.innerHTML=t.getAttribute("title")||"",e.textarea.value=n.text,e.attachments_list&&(e.attachments_list.innerHTML=""),e.attachments_container&&(e.attachments_container.innerHTML=""),e.attachments_input.value="",JournalPopups.hideAll(),this.setPopPosition(e.box,t,"top_by_bottom_position"),e.show(),isMobile||e.textarea.focus()},StandardJournal.prototype.showPopLessonNote=function(t){var e=JournalPopup.lesson_note,n=this.cur.lessonnote;FN.extend(n,{td:t,text:t.getAttribute("text")||"",subtype:t.getAttribute("subtype")||"",lesson_id:t.getAttribute("lesson_id")||""}),CURRENT.journal=this,this.toggleActiveMarkTd(),e.date.innerHTML=t.getAttribute("date"),e.textarea.value=n.text,$(e.subtypes).filter("[value="+n.subtype+"]").prop("checked",!0),JournalPopups.hideAll(),this.setPopPosition(e.box,t),e.show(),isMobile||e.textarea.focus()},StandardJournal.prototype.showPopLimitedLessonNote=function(t){var e=JournalPopup.limited_lesson_note,n=this.cur.lessonnote;FN.extend(n,{td:t,text:t.getAttribute("text")||"",subtype:t.getAttribute("subtype")||"",lesson_id:t.getAttribute("lesson_id")||""}),CURRENT.journal=this,this.toggleActiveMarkTd(),e.text.innerHTML=n.text,e.date.innerHTML=t.getAttribute("date"),$(e.subtypes).hide(),"0"!==n.subtype&&$(e.subtypes).filter("[data-subtype="+n.subtype+"]").show(),JournalPopups.hideAll(),this.setPopPosition(e.box,t),e.show()},StandardJournal.prototype.showPopTheme=function(t){var e=JournalPopup.theme,n=this.cur.theme;FN.extend(n,{td:t,text:t.getAttribute("text")||"",lesson_id:t.getAttribute("lesson_id")||""}),CURRENT.journal=this,this.toggleActiveMarkTd(),e.date.innerHTML=t.getAttribute("date"),e.textarea.value=n.text,JournalPopups.hideAll(),this.setPopPosition(e.box,t),e.show(),isMobile||e.textarea.focus()},StandardJournal.prototype.saveHometask=function(){var t,e=this,n=JournalPopup.hometask,i=this.cur.hometask,o=FN.trim(n.textarea.value);t={text:encodeURIComponent(o),lesson_id:i.lesson_id};var s="",a=[];FN.each(t,(function(t,e){a.push(t+"="+e)})),s=a.join("&"),s+="&"+$(n.form).serialize(),lockButton(n.buttonOK);var r=this.table.trHometasks.getAttribute("send_to");r?$.ajax({url:r,data:s,complete:function(t){unlockButton(n.buttonOK),isMobile||n.textarea.focus()},success:function(t){i.text=o,i.file_exists=t.exists||"0",i.attribute_id=t.id,i.td.setAttribute("text",o),i.td.setAttribute("exists",t.exists||"0"),i.td.setAttribute("attribute_id",t.id),e.processTdHometask(i.td),n.hide()}}):FN.showTopMessage("Ошибка при сохранении домашнего задания",10)},StandardJournal.prototype.saveLessonNote=function(){var t,e=this,n=JournalPopup.lesson_note,i=this.cur.lessonnote,o=$(n.subtypes).filter(":checked").val(),s=FN.trim(n.textarea.value);if(i.text!==s||i.subtype!==o){t={subtype:o,text:s,lesson_id:i.lesson_id},lockButton(n.buttonOK);var a=this.table.thead.tr_lesson_dates.getAttribute("send_to");a?$.ajax({url:a,data:t,complete:function(t){unlockButton(n.buttonOK),isMobile||n.textarea.focus()},success:function(t){i.text=s,i.subtype=o,i.td.setAttribute("text",s),i.td.setAttribute("subtype",o),e.processTdLessonDate(i.td),n.hide()}}):FN.showTopMessage("Ошибка при сохранении пометки к уроку",10)}else n.hide()},StandardJournal.prototype.saveTheme=function(){var t,e=this,n=JournalPopup.theme,i=this.cur.theme,o=FN.trim(n.textarea.value);if(i.text!==o){t={text:o,lesson_id:i.lesson_id},lockButton(n.buttonOK);var s=this.table.thead.trThemes.getAttribute("send_to");s?$.ajax({url:s,data:t,complete:function(t){unlockButton(n.buttonOK),isMobile||n.textarea.focus()},success:function(t){i.text=o,i.td.setAttribute("text",o),e.processTdTheme(i.td),n.hide()}}):FN.showTopMessage("Ошибка при сохранении темы урока",10)}else n.hide()},StandardJournal.prototype.showSubgroupTable=function(t){AbstractJournal.prototype.showSubgroupTable.call(this,t);var e=this.getSubgroupId(),n=this.table.thead.tds_lesson_date,i=this.table.tfoot.tds_lesson_date,o=this.table.tdsHometask,s=this.table.thead.tdsTheme;if(FN.each(n,(function(t,e){FN.removeClass(e,"hidden")})),FN.each(i,(function(t,e){FN.removeClass(e,"hidden")})),FN.each(s,(function(t,e){FN.removeClass(e,"hidden")})),FN.each(FN.geByTag("td",this.table.tbody),(function(t,e){FN.removeClass(e,"hidden")})),FN.each(o,(function(t,e){FN.removeClass(e,"hidden")})),0!==e){var a=[];FN.each(n,(function(t,n){var i=parseInt(n.getAttribute("subgroup_id"),10);i!==e&&i>0&&(a.push(t),FN.addClass(n,"hidden"))})),FN.each(this.table.tbody.trs,(function(t,e){if(!FN.hasClass(e,"hidden")){var n=FN.geByTag("td",e);FN.each(a,(function(t,e){FN.addClass(n[e],"hidden")}))}})),FN.each(a,(function(t,e){FN.addClass(o[e],"hidden"),FN.addClass(s[e],"hidden"),FN.addClass(i[e],"hidden")}))}if(this.lessons_count){var r=FN.geByClass("future",this.table.thead.tr_lesson_dates,"td"),l=FN.getVisibleNodes(r).length;this.lessons_count.innerHTML=l+" "+afterNumeral(l,"урок","","а","ов")}this.calcMonthsColspans(),this.addBoundary()},StandardJournal.prototype.attachEvents=function(){var t=this;isMobile||addEvent(this.scroll.box,"scroll",(function(){t.doHidePops?JournalPopups.hideAll():t.doHidePops=!0})),FN.each(this.table.tdsHometask,(function(e,n){addEvent(n,"click",(function(){t.showPopHometask(n)}))})),FN.each(this.table.thead.tds_lesson_date,(function(e,n){addEvent(n,"click",(function(){!!n.getAttribute("note-limitations")?t.showPopLimitedLessonNote(n):t.showPopLessonNote(n)}))})),FN.each(this.table.thead.tdsTheme,(function(e,n){addEvent(n,"click",(function(){t.showPopTheme(n)}))})),FN.each(this.table.tbody.tdsMark,(function(e,n){addEvent(n,"click",(function(){"..."!==n.innerHTML&&(!!n.getAttribute("mark-limitations")?t.showPopLimitedMark(n):t.showPopMark(n))}))})),this.attachEvents=function(){}};var QuartersJournal=function(t,e,n,i,o){t=FN.extend({table_id:"",left_table_id:"",scroll:!1,subgroups_menu_id:"",mark_class_name:"",allow_changes:!0},t),AbstractJournal.call(this,"QTable",e,t,n,i),this.year=o,this.table.tbody.tdsEMark=FN.geByClass("emark",this.table.tbody,"td"),this.table.tbody.tdsYMark=FN.geByClass("ymark",this.table.tbody,"td"),this.table.tbody.tdsTMark=FN.geByClass("tmark",this.table.tbody,"td"),this.processTrsMarks(),t.allow_changes&&this.attachEvents()};inherits(QuartersJournal,AbstractJournal),QuartersJournal.prototype.updateTdQMark=function(){var t=this.cur.qmark.td;AbstractJournal.prototype.updateTdQMark.call(this),this.processTrMarks(t.parentNode)},QuartersJournal.prototype.attachEvents=function(){var t=this;FN.each(this.table.tbody.tdsEMark,(function(e,n){addEvent(n,"click",(function(){t.showPopEMark(n)}))})),FN.each(this.table.tbody.tdsYMark,(function(e,n){addEvent(n,"click",(function(){t.showPopYMark(n)}))})),FN.each(this.table.tbody.tdsTMark,(function(e,n){addEvent(n,"click",(function(){t.showPopTMark(n)}))})),this.attachEvents=function(){}};var BehaviorJournal=function(t,e,n){t=FN.extend({table_id:"",left_table_id:"",scroll:!1},t),SplittedTable.call(this,null,t),this.year=n,this.urls=e||{},this.selects=FN.geByTag("select",this.table),this.behaviorAttachEvents()};inherits(BehaviorJournal,SplittedTable),BehaviorJournal.prototype.saveBehavior=function(t){var e={pupil_id:t.getAttribute("pupil_id"),quarter_id:t.getAttribute("quarter_id"),year:this.year,note:t.value};t.disabled=!0,$.ajax({url:this.urls.save,data:e,success:function(e){FN.removeClass(t,"error")},error:function(e,n){SETTINGS.ajaxParams.error(e,n),FN.addClass(t,"error")},complete:function(){t.disabled=!1}})},BehaviorJournal.prototype.behaviorAttachEvents=function(){var t=this;FN.each(this.selects,(function(e,n){addEvent(n,"change",(function(e){t.saveBehavior(n)}))})),this.behaviorAttachEvents=function(){}};var AbsencesJournal=function(t,e,n){t=FN.extend({table_id:"",left_table_id:"",scroll:!1},t),SplittedTable.call(this,null,t),this.urls=e||{},this.inputs=FN.geByTag("input",this.table),this.processTable(),this.absencesAttachEvents()};inherits(AbsencesJournal,SplittedTable),AbsencesJournal.prototype.saveCounter=_.debounce((function(t){var e=t.getAttribute("saved-count"),n={pupil_id:t.getAttribute("pupil_id"),monday:t.getAttribute("monday"),type:t.getAttribute("record_type"),count:t.value||null};e!==n.count&&$.ajax({url:this.urls.save,data:n,success:function(){FN.removeClass(t,"error"),t.setAttribute("saved-count",n.count)},error:function(e,n){SETTINGS.ajaxParams.error(e,n),FN.addClass(t,"error")},complete:function(){}})}),50),AbsencesJournal.prototype.processTable=function(){var t=this.table.tbody.trs.length;FN.each(this.table.tbody.trs,(function(e,n){var i=FN.geByTag("input",n);FN.each(i,(function(n,i){var o=Math.floor(n/2),s=t*o*2+2*e+n%2+1;i.setAttribute("tabindex",s)}))}))},AbsencesJournal.prototype.absencesAttachEvents=function(){var t=this;FN.each(this.inputs,(function(e,n){addEvent(n,"focus",(function(t){n.select()})),addEvent(n,"change",(function(e){t.saveCounter(n)})),addEvent(n,"keyup",(function(e){t.saveCounter(n)}))})),$(this.table).find(".js-absences-copy").on("click",(function(){var t=$(this).closest("td"),e=t.find(".js-absences-counter"),n=t.next().find("input"),i=e.data("counter");n.val(i),n.trigger("change")})),this.absencesAttachEvents=function(){}};var daybookController=function(t,e){t=FN.extend({quartersMenu:"",quartersContainer:"",lastPageLink:"",lastPageContainer:""},t),this.pupilID=e,this.loadedQuarters=[],this.qMenu=FN.ge(t.quartersMenu),this.qContainer=FN.ge(t.quartersContainer),this.lastPageLink=FN.ge(t.lastPageLink),this.lastPageContainer=FN.ge(t.lastPageContainer),this.lastPageLoaded=!1,this.qContainer&&this.qMenu&&(this.qMenuCurrentLink=FN.geByClass1("current",this.qMenu,"a"),this.qMenuLinks=FN.geByClass("past",this.qMenu,"a").concat(this.qMenuCurrentLink||[]),this.qMenuLinks&&this.qMenuLinks.length?(this.className={daybook:"db_quarter"},isMobile||this.showQuarterDaybook(this.qMenuCurrentLink||this.qMenuLinks.slice(-1)[0]),this.qAttachEvents()):this.qContainer.innerHTML='<div class="sbp clr-red">Четверти не заполнены или еще не началась ни одна четверть</div>')};daybookController.prototype.showQuarterDaybook=function(t){if(t){var e=this.className.daybook,n=t.getAttribute("quarter_id"),i=e+"_"+this.pupilID+"_"+n,o=t.getAttribute("src")||"";if(FN.each(this.qMenuLinks,(function(t,e){FN.removeClass(e.parentNode,"active")})),FN.removeClass(this.lastPageLink.parentNode,"active"),FN.addClass(t.parentNode,"active"),FN.each(FN.geByClass(e,this.qContainer,"div"),(function(t,e){FN.hide(e)})),FN.hide(this.lastPageContainer),FN.show(this.qContainer),FN.inArray(n,this.loadedQuarters)||FN.ge(i))FN.show(FN.ge(i));else{this.loadedQuarters.length||(this.qContainer.innerHTML=""),this.loadedQuarters.push(n);var s=FN.ce("div",{id:i,className:e});this.qContainer.appendChild(s),this._load(o,s)}}},daybookController.prototype._load=function(t,e){$.ajax({type:"get",dataType:"html",url:t,beforeSend:function(t,n){SETTINGS.ajaxParams.beforeSend(t,n),e.innerHTML=loader},success:function(t){$(e).html(t)},error:function(t,n){SETTINGS.ajaxParams.error(t,n),e.innerHTML='<div class="sbp clr-red">Ошибка при загрузке</div>'}})},daybookController.prototype.showLastPage=function(){var t=this;function e(){FN.hide(t.qContainer),FN.show(t.lastPageContainer),FN.each(t.qMenuLinks,(function(t,e){FN.removeClass(e.parentNode,"active")})),FN.addClass(t.lastPageLink.parentNode,"active")}t.lastPageLoaded?e():$.ajax({type:"get",dataType:"html",url:t.lastPageLink.getAttribute("src"),success:function(n){$(t.lastPageContainer).html(n),t.lastPageLoaded=!0,e()},error:function(e,n){SETTINGS.ajaxParams.error(e,n),t.lastPageContainer.innerHTML='<div class="sbp clr-red">Ошибка при загрузке</div>'}})},daybookController.prototype.qAttachEvents=function(){var t=this;isMobile||FN.each(this.qMenuLinks,(function(e,n){addEvent(n,"click",(function(){FN.hasClass(n.parentNode,"active")||t.showQuarterDaybook(n)}))})),isMobile||addEvent(this.lastPageLink,"click",(function(){if(!FN.hasClass(this.parentNode,"active"))return t.showLastPage(),!1})),this.qAttachEvents=function(){}};var Daybook=function(t,e,n,i){t=FN.extend({currentWeekLink:"",weeksContainer:"",weekClassName:""},t),this.quarterID=e,this.pupilID=n,this.currentWeekID=i,this.currentWeekLink=FN.ge(t.currentWeekLink),this.weeksContainer=FN.ge(t.weeksContainer),this.className={week:t.weekClassName},this.loadedWeeks=[],this.attachEvents()};Daybook.prototype.showWeek=function(t,e,n,i){var o=this,s=t.prevLink,a=t.nextLink,r=FN.domNS((s||a).parentNode),l=this.className.week,c=l+"_"+this.pupilID+"_"+this.quarterID+"_"+t.weekID,u=l+"_"+this.pupilID+"_"+this.quarterID+"_"+e;!i&&FN.inArray(e,this.loadedWeeks)?(FN.hide(c),FN.show(u)):$.ajax({type:"get",dataType:"html",url:n,beforeSend:function(t,e){SETTINGS.ajaxParams.beforeSend(t,e),$("#"+u).remove(),FN.show(r),FN.hide(s,a)},success:function(t){var n=FN.ce("div",{className:l,id:u,week:e});FN.hide(c),o.weeksContainer.appendChild(n),$(n).html(t)},complete:function(t){FN.hide(r),FN.show(s,a)}})},Daybook.prototype.reloadWeek=function(t,e,n){this.showWeek(t,e,n,!0)},Daybook.prototype.showCurrentWeek=function(){var t=this,e=this.className.week,n=e+"_"+this.pupilID+"_"+this.quarterID+"_"+this.currentWeekID;FN.each(this.loadedWeeks,(function(n,i){var o=e+"_"+t.pupilID+"_"+t.quarterID+"_"+i;FN.hide(o)})),FN.show(n)},Daybook.prototype.attachEvents=function(){var t=this;addEvent(this.currentWeekLink,"click",(function(){t.showCurrentWeek()})),this.attachEvents=function(){}};var DaybookWeek=function(t,e,n,i){t=FN.extend({daybook:{},prevLink:"",nextLink:"",boxSign:"",formSign:"",formSignCancel:"",noteWriteBox:"",noteWriteText:"",noteWriteButton:"",notesList:"",noteRowClassName:""},t),this.daybook=t.daybook,this.weekID=e,this.weekUrl=n,this.pupilID=i,this.prevLink=FN.ge(t.prevLink),this.nextLink=FN.ge(t.nextLink),this.boxSign=FN.ge(t.boxSign),this.formSign=FN.ge(t.formSign),this.formSignCancel=FN.ge(t.formSignCancel),this.noteWriteBox=FN.ge(t.noteWriteBox),this.noteWriteText=FN.ge(t.noteWriteText),this.noteWriteButton=FN.ge(t.noteWriteButton),this.notesList=FN.ge(t.notesList),this.classNames={noteRow:t.noteRowClassName},this.daybook.loadedWeeks.push(e),this.attachEvents()};function DaybookLastPage(t){t=FN.extend({table_id:""},t),this.$table=$("#"+t.table_id),this.$table.length?(this.countAverageMarks(),this.attachEvents()):FN.log("DaybookLastPage: не задана основная таблица")}function changeCheckboxes(t,e){var n=FN.ge(t);if(n){var i=FN.geByAttr("type","checkbox","input",n);i&&i.length&&FN.each(i,(function(t,n){n.checked=e}))}}function afterNumeral(t,e,n,i,o){var s=e;return t%100>10&&t%100<20?s+o:s+=1===(t%=10)?n:t>=2&&t<=4?i:o}function clickActiveAnchor(t){if((t=t||LOC.hash)&&"photo"==t.substr(0,5)){var e=1*t.substr(5);$('a[href$="/photo/'+e+'"]').click()}}function gridStatsIntoView(){$(".grid-stats-1").get(0).scrollIntoView(!1)}DaybookWeek.prototype.showWeek=function(t,e,n){Daybook.prototype.showWeek.apply(this.daybook,arguments)},DaybookWeek.prototype.reloadWeek=function(t,e,n){var i=this.daybook.loadedWeeks.indexOf(e);this.daybook.loadedWeeks.splice(i,1),Daybook.prototype.reloadWeek.apply(this.daybook,arguments)},DaybookWeek.prototype.alignHeight=function(){},DaybookWeek.prototype.deleteNote=function(t){if(!confirm("Уверены?"))return!1;var e=t.getAttribute("src"),n=FN.ge(t.getAttribute("rowID")),i=n.parentNode,o=FN.geByClass("message_row",i,"div");$.ajax({url:e,type:"get",dataType:"text",success:function(t){o&&1===o.length?i.innerHTML='<div class="mess_empty">Нет</div>':i.removeChild(n)}})},DaybookWeek.prototype.attachEvents=function(){var t=this;addEvent(this.prevLink,"click",(function(){var e=t.prevLink.getAttribute("send_to"),n=t.prevLink.getAttribute("prev_week_id");t.showWeek(t,n,e)})),addEvent(this.nextLink,"click",(function(){var e=t.nextLink.getAttribute("send_to"),n=t.nextLink.getAttribute("next_week_id");t.showWeek(t,n,e)})),FN.each([this.formSign,this.formSignCancel],(function(e,n){n&&addEvent(n,"submit",(function(e){if(!confirm("Вы уверены?"))return!1;var i=$(n).serialize(),o=n.getAttribute("action");return t.boxSign.innerHTML=loader,$.ajax({url:o,data:i,dataType:"html",success:function(e){t.boxSign.innerHTML='<div class="signed_result">'+n.getAttribute("phrase")+"</div>"},complete:function(){t.reloadWeek(t,t.weekID,t.weekUrl)}}),!1}))})),this.noteWriteBox&&addEvent(this.noteWriteButton,"click",(function(){var e=this,n=FN.trim(t.noteWriteText.value);n&&(lockButton(e),$.ajax({url:$(this).attr("send_to"),data:{text:n},dataType:"text",success:function(e){$(t.notesList).html(e),t.noteWriteText.value=""},complete:function(){unlockButton(e)}}))})),this.attachEvents=function(){}},DaybookLastPage.prototype.countAverageMarks=function(){var t=this;this.$table.find("tr.marks").each((function(){var e=$(this),n=$("td.qmark",e),i=t._getAverageMark(n)||"&mdash;";e.find("td.avg").html(i)}))},DaybookLastPage.prototype._getAverageMark=function(t){var e=[];t.each((function(){var t=FN.trim(FN.stripHTML($(this).html()));for(var n in t=t.split("/"))$.isNumeric(t[n])&&e.push(1*t[n])}));var n=0;for(var i in e)n+=e[i];var o=n/e.length;return Math.round(100*o)/100},DaybookLastPage.prototype._sign=function(t){var e=this,n=t.closest("td"),i=t.data("url");if(!confirm("Вы уверены?"))return!1;t.addClass("processing"),$.ajax({url:i,success:function(t){var i=e._getSignedHtml(t);n.html(i)},complete:function(){t.removeClass("processing")}})},DaybookLastPage.prototype._getSignedHtml=function(t){return'<div class="lp-sign"><a class="dashed-lnk"><b>Подписано</b></a><div class="lp-sign__popover"><div class="lp-sign__popover-time">'+t.date+'</div><div class="lp-sign__popover-name">'+t.parent+"</div></div></div>"},DaybookLastPage.prototype.attachEvents=function(){var t=this;this.$table.find(".js-sign-link").on("click",(function(){var e=$(this);t._sign(e)}))},$(document).ready((function(){if($("#edit_library_category input[type=checkbox]").on("change",(function(){$("#edit_library_category input[type=checkbox]").not(this).prop("checked",!1)})),$("#album_size").length){var t={};function e(t){return logarithm=Math.log2(t),logarithm<10?String(t)+" Байт":logarithm<20?String((t/1024).toFixed(2))+" КБ":String((t/1024/1024).toFixed(2))+" МБ"}function n(t){t.recalculateSize(),$(".edit_photos_list .photo_size").each((function(n,i){$(i).html(e(t.currentPhotosSizes[n]))})),$("#album_size").html(e(t.size)),$("#album_size_all").html(e(t.sizeAll)),t.size>t.maxSize?$("#album_max_size_warning").html("Превышен лимит размера фотоальбома"):$("#album_max_size_warning").html(""),t.sizeAll>t.maxSizeAll?$("#album_max_size_all_warning").html("Превышен лимит размера фотоальбомов. Рекомендуем очистить старые альбомы"):$("#album_max_size_all_warning").html("")}t.existingPhotosSizes=$(".edit_photos_list .photo_size").map((function(t,e){return parseInt($(e).text())})).toArray(),t.currentPhotosSizes=$(".edit_photos_list .photo_size").map((function(t,e){return parseInt($(e).text())})).toArray(),t.photosToDelete=[],t.maxSize=parseInt($("#album_max_size").text()),t.maxSizeAll=parseInt($("#album_max_size_all").text()),t.size=parseInt($("#album_size").text()),t.sizeAll=parseInt($("#album_size_all").text()),t.sizeOthers=t.sizeAll-t.size,$("#album_max_size").html(e(t.maxSize)),$("#album_max_size_all").html(e(t.maxSizeAll)),t.recalculateSize=function(){var e=0,n=this.photosToDelete;t.currentPhotosSizes.forEach((function(t,i){i<n.length&&!0===n[i]||(e+=t)})),t.size=e,t.sizeAll=t.sizeOthers+e},t.setCurrentSize=function(e,n){t.currentPhotosSizes[e]=n},t.setCurrentSizeToExisting=function(e){t.currentPhotosSizes[e]=t.existingPhotosSizes[e]},n(t),$('.edit_photos_list input[type="file"]').on("change",(function(){i=$('.edit_photos_list input[type="file"]').index(this),0!==this.files.length?t.setCurrentSize(i,this.files[0].size):t.setCurrentSizeToExisting(i),n(t)})),$('.edit_photos_list .edit_photo_cc .actions input[type="checkbox"]').on("click",(function(){t.photosToDelete=$('.edit_photos_list .fl_r input[type="checkbox"]').map((function(t,e){return e.checked})),n(t)}))}var o=$(".hometask_progress");if(o.length){$(o[0]).children("span")[0],$(o[0]).children("progress")[0];var s=parseInt(o[0].id);var a=setInterval((function(){$.get("/admin/attachments/hometasks/progress/"+s.toString(),(function(t){if(console.log(t),"fail"==t.status)return console.log(t),!1;$(o[0]).children("progress")[0].value=t.progress,$(o[0]).children("span")[0].innerText=t.progress,100==t.progress&&(clearInterval(a),location.reload(!0))}))}),1e3)}"Photoview"in window&&Photoview.init(),$(".hidden_text").each((function(t,e){var n=$(e);$(".link",e).click((function(){n.addClass("vis")})),$(".text",e).click((function(){n.removeClass("vis")}))})),$(".sch_menu_box li.f1 .d1").each((function(){var t=$(this),e=$(".with_num",t);e.length>1&&(e.eq(0).css({"margin-top":"-12px","font-size":"11px"}),e.eq(1).css({"margin-top":"-1px","font-size":"11px"}))})),$("#google_translate_element .link").click((function(t){return $.ajax({type:"get",dataType:"script",url:"//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit",success:function(t){$("#google_translate_element").html("")}}),t.preventDefault(),!1})),$("#google-search-form").submit((function(){var t=$(this),e=t.find('input[name="q"]'),n=document.location.href;return n=(n=n.replace("http://","").replace("https://","")).split("?")[0].split("#")[0].split("/")[0],window.location.href=t.attr("action")+"?q=site:"+n+" "+e.val(),!1}));var r=$("#sch_login_box"),l=$("#sch_login_lnk");l.on("click",(function(){var t=$(this);return l.hasClass("act")?(t.removeClass("act"),r.hide()):(t.addClass("act"),r.show()),!1})),$("body").click((function(t){$(t.target).parents("#sch_login_box").length||$(t.target).filter("#sch_login_box").length||$(t.target).parents("#sch_login_lnk").length||$(t.target).filter("#sch_login_lnk").length||($("#sch_login_box").hide(),$("#sch_login_lnk").removeClass("act"))}));var c=$("#u_navigation_lnk"),u=$("#u_navigation_box");c.on("click",(function(){return c.hasClass("act")?(u.hide(),c.removeClass("act")):(u.show(),c.addClass("act")),!1})),$("body").click((function(t){$(t.target).parents("#u_navigation_box").length||$(t.target).filter("#u_navigation_box").length||$(t.target).parents("#u_navigation_lnk").length||$(t.target).filter("#u_navigation_lnk").length||(u.hide(),c.removeClass("act"))}));var d,h=$(".u-messages.new"),p=h.parent().width();h.parent().width(p),function t(){h.animate({opacity:.1},50,(function(){setTimeout((function(){h.animate({opacity:1},250),setTimeout((function(){t()}),2600)}),100)}))}(),$(".sch_menu_box li.f1, .sch_menu_box2 li.f1").each((function(){var t=$(this);t.find("li.act2").length&&t.addClass("act3").removeClass("closed"),t.find("li").length&&t.addClass("yes");var e=t.find("ul");e.find("li").length||e.remove()})),$.cookie("slc_cookie")||$.cookie("slc_cookie","{slcMakeBetter}",{domain:LOC.domain,path:"/",expires:30}),$(".slc_box").each((function(){var t=$(this),e=$.cookie("slc_cookie"),n="{"+t.attr("cookie")+"}";e&&e.indexOf(n)>-1&&(t.removeClass("open"),t.find(".slc_for_hide").slideUp(0))})),$(".slc_title").each((function(){var t=$(this),e=$(".slc_arrow",t),n=t.parents(".slc_box").eq(0),i=$(".slc_for_hide",n),o=$.cookie("slc_cookie"),s="{"+n.attr("cookie")+"}";(t.hasClass("not_clickable")?e:t).click((function(){return n.hasClass("open")?(i.slideUp(400,(function(){n.removeClass("open")})),o+=s):(i.slideDown(400,(function(){})),n.addClass("open"),o=o.replace(new RegExp(s+"","g"),"")),$.cookie("slc_cookie",o,{domain:LOC.domain,path:"/",expires:30}),!1}))})),$(".sch_header_pop .close").click((function(t){var e=$(this).parents(".sch_header_pop:first");$(".hint_text",e).hide(200,(function(){$(".hint_lnk_wrap",e).show()}));var n=$.cookie("slc_cookie");n&&n.indexOf("{headerPopupsIsClosed}")<=-1&&(n+="{headerPopupsIsClosed}",$.cookie("slc_cookie",n,{domain:LOC.domain,path:"/",expires:30})),t.preventDefault()})),$(".sch_header_pop .hint_lnk").click((function(t){var e=$(this).parents(".sch_header_pop:first");$(".hint_lnk_wrap",e).hide(),$(".hint_text",e).show(200);var n=$.cookie("slc_cookie");n&&(n=n.replace("{headerPopupsIsClosed}",""),$.cookie("slc_cookie",n,{domain:LOC.domain,path:"/",expires:30})),t.preventDefault()})),$(".lim_sliding").each((function(){var t=$(this);t.height()>330&&(t.css("height","280px"),t.append('<div class="lim_sh"></div>'),t.after('<div class="lim_alink_wrap"><a class="lim_alink">Показать текст полностью</a></div>'))})),$(".lim_alink").on("click",(function(){var t=$(this),e=t.parents(".lim_height").eq(0);t.hasClass("hide")?($(".lim_sh",e).show(),t.removeClass("hide").html("Показать текст полностью"),$(".lim_sliding",e).css("height","280px")):($(".lim_sh",e).hide(),t.addClass("hide").html("Скрыть текст"),$(".lim_sliding",e).css("height","auto"))})),"fancybox"in $&&($(".fancy-full").fancybox({maxWidth:"98%",fitToView:!1,autoSize:!1,closeClick:!1}),$('a[rel="fancy-pics"], .fancy-photo').fancybox()),$(".with-flow-pop").on("mouseenter",(function(){var t=$(".flow-pop",$(this));clearTimeout(d),$(".flow-pop").hide(),t.show(),t.css("bottom","7px")})),$(".with-flow-pop").on("mouseleave",(function(){var t=$(".flow-pop",$(this));d=setTimeout((function(){t.hide()}),500)}));var f,g,_,m=$("#sch_event_pop"),v=parseInt(m.css("left"));$("#slc_events_list").on("mouseenter",".site_event_box",(function(){var t=$(this),e=t.find(".for-pop-info").html();clearTimeout(d),f=setTimeout((function(){$(".flow-pop-cnt",m).html(e);var n=t.position().top+(t.outerHeight()-m.outerHeight())/2;m.css("top",n+"px"),m.css("left",v+7+"px"),m.show().animate({left:v+"px"},140)}),200)})),$("#slc_events_list").on("mouseleave",".site_event_box",(function(){clearTimeout(f),d=setTimeout((function(){$("#sch_event_pop").fadeOut(150)}),300)})),m.hover((function(){clearTimeout(d),$(this).stop(!0,!0).fadeIn(200)}),(function(){clearTimeout(f),d=setTimeout((function(){$("#sch_event_pop").fadeOut(150)}),300)})),g=$("#index_ph_list"),"function"==typeof $.prototype.carouFredSel&&g.length&&g.carouFredSel({width:"100%",circular:!1,infinite:!1,auto:!1,onCreate:function(){$(".index_ph_arrs").show()},scroll:{items:1,duration:300},prev:"#index_ph_prev",next:"#index_ph_next"}),_=$(".js-footer-banners-slider"),"function"==typeof $.prototype.carouFredSel&&_.length&&_.carouFredSel({width:"100%",responsive:!1,circular:!0,infinite:!0,auto:{play:!0,timeoutDuration:5e3},scroll:{pauseOnHover:"resume",items:null,duration:400,onBefore:function(t){_.css({"margin-top":-(_.height()-t.height)/2+"px"})}},prev:"#footer-banners-prev",next:"#footer-banners-next",onCreate:function(t){_.css({"margin-top":-(_.height()-t.height)/2+"px"})}}),$(function(){var t=$('input[type="checkbox"].chb-change');function e(t,e){if(t){e=e||0;var n=t.data("boxid"),i=$("#"+n);t.is(":checked")?e?i.stop().slideDown(e):i.show():e?i.stop().slideUp(e):i.hide()}}t.each((function(){e($(this),0)})),t.change((function(){e($(this),200)}))}()),$(".class_lns_list li").click((function(){var t=$(this).find("span").html();$(this).parents("ul").eq(0).prev().filter("input").val(t)})),$(".sch_pop2 .close_link").on("click",(function(){return $(this).parents(".sch_pop2").eq(0).hide(400),!1})),$("a.confirm").on("click",(function(){var t=$(this).data("confirm")||"Вы уверены?";return confirm(t)})),$("form.confirm").on("submit",(function(){var t=$(this).data("confirm")||"Вы уверены?";return confirm(t)})),$("img:not(img[alt])").attr("alt","Изображение"),$(".sliding-all").click((function(t){var e=$(this),n=e.data("id"),i=$("#"+n),o=$(".sliding",i),s=$(".sliding-b",i),a=o.filter(".open").length,r=o.filter(':not(".open")').length;return!a||r&&!e.hasClass("open")?(e.addClass("open"),o.addClass("open"),s.slideDown(),!1):!r||a&&e.hasClass("open")?(e.removeClass("open"),o.removeClass("open"),s.slideUp(),!1):void 0})),$('.sliding:not(".open") > .sliding-b').slideUp(0),$("body").on("click",".sliding-link",(function(t){var e=$(this),n=e.parents(".sliding:first"),i=n.find("> .sliding-b");$(".sliding-b:animated").length||(n.hasClass("open")?i.slideUp(500,(function(){n.removeClass("open")})):(n.addClass("open"),i.slideDown(500))),e.attr("rel")&&(n.hasClass("open")?window.location.href=window.location.href.split("#")[0]+"#"+e.attr("rel"):window.location.href=window.location.href.split("#")[0]+"#"),t.preventDefault()})),$(".sliding").each((function(){var t=$(this),e=window.location.href.split("#")[1];$(".sliding-link:first",t).attr("rel")&&$(".sliding-link:first",t).attr("rel")==e&&($(".sliding-b:first",t).slideDown(0),t.addClass("open"))})),$("body").on("click","a.delete-and-hide",(function(){var t=$(this),e=t.data("confirm")||"Вы уверены?";if(!confirm(e))return!1;var n=t.attr("href"),i=t.parents(t.attr("hide_element")).first();return n?$.ajax({type:"get",dataType:"text",url:n,success:function(t){i.slideUp(300,(function(){i.remove()}))}}):i.slideUp(300,(function(){i.remove()})),!1})),$(".print_logins .item .delete").click((function(){$(this).parents(".item:first").slideUp(600)})),$(".drdown_link").click((function(){var t=$(this).parents(".drdown:first");t.toggleClass("open"),$("textarea",t).focus()})),$("body").click((function(t){$(t.target).parents(".drdown").length||$(".drdown").removeClass("open")})),$(".news_subscribe_link").click((function(){var t=$(this).parents(".news_subscribe:first"),e=$(".news_subscribe_sbscr",t),n=$(".news_subscribe_result",t);$.ajax({url:$(this).attr("send_to"),dataType:"html",dataFilter:function(t){return e.remove(),n.show(),t},success:function(t){n.html('<div class=" success"><b>Вы подписались на новости</b>.<br/>\n\t\t\t\t\tОтписаться от новостей вы можете в настройках личной информации.</div>')},error:function(t,e){SETTINGS.ajaxParams.error(t,e),n.html('<div class=" failure">Ошибка.</div>')}})})),clickActiveAnchor()}));var GoogleChart={isScriptLoaded:!1,general:function(t,e,n,i,o){google.load("visualization","1",{packages:["corechart"]}),google.setOnLoadCallback((function(){GoogleChart._general(t,e,n,i,o)}))},_general:function(t,e,n,i,o){for(var s in e)if("date"==e[s][0])for(var a in t){var r=new Date;r.setTime(t[a][0]),t[a][0]=r}var l=new google.visualization.DataTable;for(var s in e)null==e[s].length?l.addColumn(e[s]):l.addColumn(e[s][0],e[s][1]);l.addRows(t);var c=new google.visualization.DateFormat({pattern:"EEEE, d MMMM yyyy г."});for(var s in e)"date"==e[s][0]&&c.format(l,parseInt(s));var u={hAxis:{format:"dd MMM yyyy"},interpolateNulls:!0,chartArea:{left:50,top:30,width:"90%",height:"70%"},title:n,backgroundColor:"#f1f9fd",areaOpacity:.15,legend:"bottom",pointSize:2,seriesType:"area",focusTarget:"category",lineWidth:1,vAxis:{format:"#"}};o=$.extend(!0,u,o),"string"==e[0][0]&&t.length>15&&(o=$.extend(!0,o,{hAxis:{slantedTextAngle:90}})),new google.visualization.ComboChart(document.getElementById(i)).draw(l,o)}};function loadScript(t,e){var n=document.createElement("script");n.type="text/javascript",n.src=t,n.readyState?n.onreadystatechange=function(){"loaded"!=n.readyState&&"complete"!=n.readyState||(n.onreadystatechange=null,e())}:(n.onload=function(){e()},n.onerror=function(){}),document.getElementsByTagName("head")[0].appendChild(n)}function googleTranslateElementInit(){new google.translate.TranslateElement({includedLanguages:"ru,be,en",layout:google.translate.TranslateElement.InlineLayout.SIMPLE},"google_translate_element")}!function(t){"use strict";var e=function(e){this.element=t(e)};e.prototype={constructor:e,show:function(){var e,n,i,o=this.element,s=o.closest("ul"),a=o.attr("data-target");a||(a=(a=o.attr("href"))&&a.replace(/.*(?=#[^\s]*$)/,"")),o.parent("li").hasClass("active")||(e=s.find(".active a").last()[0],i=t.Event("show",{relatedTarget:e}),o.trigger(i),i.isDefaultPrevented()||(n=t(a),this.activate(o.parent("li"),s),this.activate(n,n.parent(),(function(){o.trigger({type:"shown",relatedTarget:e})})),s.data("savehash")&&(window.location.href=window.location.href.split("#")[0]+a+"-open")))},activate:function(e,n,i){var o=n.find("> .active"),s=i&&t.support.transition&&o.hasClass("fade");function a(){o.removeClass("active"),e.addClass("active"),s?(e[0].offsetWidth,e.addClass("in")):e.removeClass("fade"),i&&i()}s?o.one(t.support.transition.end,a):a(),o.removeClass("in")}},t.fn.tab=function(n){return this.each((function(){var i=t(this),o=i.data("tab");o||i.data("tab",o=new e(this)),"string"==typeof n&&o[n]()}))},t.fn.tab.Constructor=e,t((function(){t("body").on("click.tab.data-api",'[data-toggle="tab"]',(function(e){t(this).tab("show"),e.preventDefault()})),t('[data-toggle="tab"][href="#'+LOC.hash+'"]').click()}))}(window.jQuery),function(t){"use strict";var e=function(e){this.element=t(e)};e.prototype={constructor:e,filtrate:function(){var e,n,i=this.element,o=i.closest("ul"),s=i.data("target"),a=i.data("params");if(!i.parent("li").hasClass("active")&&(s||(s=(s=i.attr("href"))&&s.replace(/.*(?=#[^\s]*$)/,"")),s&&(n=t.Event("filtrate",{}),i.trigger(n),!n.isDefaultPrevented()))){e=t(s),o.find("> .active").removeClass("active"),i.parent("li").addClass("active");var r,l=0;if("all"==a)(r=t('[data-filter][data-filter!="no_items"]',e)).show(),l+=r.length;else for(var c in a=a.split(","),t("[data-filter]",e).hide(),a)(r=t('[data-filter="'+a[c]+'"]',e)).show(),l+=r.length;0===l&&t('[data-filter="no_items"]',e).show()}}},t.fn.filter2=function(){return this.each((function(){var n=t(this),i=n.data("filter");i||n.data("filter",i=new e(this)),i.filtrate()}))},t.fn.filter2.Constructor=e,t((function(){t("body").on("click.filter2",'[data-toggle="filter"]',(function(e){e.preventDefault(),t(this).filter2(),t(this).parents(".drdown:first").removeClass("open")}))}))}(window.jQuery),function(t){"use strict";var e="[data-toggle=dropdown]",n=function(e){var n=t(e).on("click.dropdown.data-api",this.toggle);t("html").on("click.dropdown.data-api",(function(){n.parent().removeClass("open")}))};function i(){o(t(e)).removeClass("open")}function o(e){var n,i=e.attr("data-target");return i||(i=(i=e.attr("href"))&&/#/.test(i)&&i.replace(/.*(?=#[^\s]*$)/,"")),(n=t(i)).length||(n=e.parent()),n}n.prototype={constructor:n,toggle:function(e){var n,s,a=t(this);if(!a.is(".disabled, :disabled"))return s=(n=o(a)).hasClass("open"),i(),s||(n.toggleClass("open"),a.focus()),!1},keydown:function(e){var n,i,s,a,r;if(/(38|40|27)/.test(e.keyCode)&&(n=t(this),e.preventDefault(),e.stopPropagation(),!n.is(".disabled, :disabled"))){if(!(a=(s=o(n)).hasClass("open"))||a&&27==e.keyCode)return n.click();(i=t("[role=menu] li:not(.divider) a",s)).length&&(r=i.index(i.filter(":focus")),38==e.keyCode&&r>0&&r--,40==e.keyCode&&r<i.length-1&&r++,~r||(r=0),i.eq(r).focus())}}},t.fn.dropdown=function(e){return this.each((function(){var i=t(this),o=i.data("dropdown");o||i.data("dropdown",o=new n(this)),"string"==typeof e&&o[e].call(i)}))},t.fn.dropdown.Constructor=n,t((function(){t("html").on("click.dropdown.data-api touchstart.dropdown.data-api",i),t("body").on("click.dropdown touchstart.dropdown.data-api",".dropdown form",(function(t){t.stopPropagation()})).on("click.dropdown.data-api touchstart.dropdown.data-api",e,n.prototype.toggle).on("keydown.dropdown.data-api touchstart.dropdown.data-api",e+", [role=menu]",n.prototype.keydown)}))}(window.jQuery);